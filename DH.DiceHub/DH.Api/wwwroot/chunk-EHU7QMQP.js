import{a as ee}from"./chunk-W43YP37E.js";import{b as ln,c as mn}from"./chunk-AF5TXU3F.js";import{a as De}from"./chunk-6JEORSH2.js";import{a as te}from"./chunk-RG3YGCS2.js";import{a as Oe,b as Te,c as it,d as Re,e as ke,f as sn}from"./chunk-257RNC4W.js";import{a as st,b as pn}from"./chunk-N5AFSSXM.js";import{a as on}from"./chunk-B6POORFO.js";import{a as Ne,b as G,c as an}from"./chunk-4XCZJEOQ.js";import{a as F}from"./chunk-PQJ34A2R.js";import{a as X}from"./chunk-ELPMLOTJ.js";import{a as rt,c as ot,d as cn}from"./chunk-S4L6UGIL.js";import{Aa as $,Bc as en,Ca as j,Dc as tn,Ea as S,Ec as E,Fa as C,Gb as et,Gc as nn,Hb as pe,Ia as Tt,Ib as tt,Ic as de,Ja as Rt,Jb as Qt,Kb as Pe,Kc as K,L as Ut,La as Ue,Lb as nt,M as ze,Ma as Be,Mb as zt,Na as je,Nb as Zt,Nc as kt,O as Bt,Oa as Ft,Oc as he,Pa as g,Pb as Yt,Pc as xe,Qa as z,Qc as Ee,Ra as V,Rb as Jt,S as A,Sa as Ye,Sc as ce,T as Ze,Ta as qt,Ua as Je,Va as Ke,Vb as Kt,Vc as rn,W as T,Wa as Xe,Wb as Xt,X as R,Y as k,Z as se,a as y,b as le,ba as jt,c as Se,cb as q,db as Ce,eb as ae,fa as Me,g as b,ha as Nt,ia as d,j as Qe,ja as h,kb as Vt,mb as Gt,na as Ht,oa as M,ob as Wt,pb as ye,qa as _,qb as Z,s as $e,tb as Ie,u as oe,ub as me,wa as c,xa as m,ya as w,yc as U,za as L}from"./chunk-JJGLVIRE.js";var H=(()=>{let e=class e{constructor(n){this.api=n}getList(n=""){return this.api.post(`/${E.ROOMS.CORE}/${E.ROOMS.LIST}`,{searchExpression:n})}getMembers(n,i=""){return this.api.post(`/${E.ROOMS.CORE}/${E.ROOMS.MEMBER_LIST}`,{id:n,searchExpression:i})}removeMember(n,i){return this.api.post(`/${E.ROOMS.CORE}/${E.ROOMS.REMOVE_MEMBER}`,{id:n,userId:i})}getMessageList(n){return this.api.get(`/${E.ROOMS.CORE}/${n}/${E.ROOMS.MESSAGE_LIST}`)}getInfoMessageList(n){return this.api.get(`/${E.ROOMS.CORE}/${n}/${E.ROOMS.INFO_MESSAGE_LIST}`)}checkUserParticipateInRoom(n){return this.api.get(`/${E.ROOMS.CORE}/${n}/${E.ROOMS.CHECK_USER_PARTICIPATION}`)}getById(n){return this.api.get(`/${E.ROOMS.CORE}/${n}`)}add(n){return this.api.post(`/${E.ROOMS.CORE}`,{room:n})}update(n){return this.api.put(`/${E.ROOMS.CORE}`,{room:n})}join(n){return this.api.post(`/${E.ROOMS.CORE}/${E.ROOMS.JOIN}`,{id:n})}leave(n){return this.api.post(`/${E.ROOMS.CORE}/${E.ROOMS.LEAVE}`,{id:n})}delete(n){return this.api.delete(`/${E.ROOMS.CORE}/${n}`)}};e.\u0275fac=function(i){return new(i||e)(Bt(nn))},e.\u0275prov=Ut({token:e,factory:e.\u0275fac,providedIn:"root"});let r=e;return r})();function Tn(r,e){r&1&&(c(0,"div",5),w(1,"img",6),c(2,"p",7),g(3,"No Available Rooms"),m()())}function Rn(r,e){if(r&1&&(c(0,"div",16),w(1,"app-chip",17)(2,"app-chip",17)(3,"app-chip",17),m()),r&2){let t=e.ngIf,n=C().$implicit;d(),_("color","blue")("text",t)("size","middle"),d(),Rt("text","",n.joinedParticipants," joined"),_("color","orange")("size","middle"),d(),Rt("text","",n.maxParticipants," max"),_("color","red")("size","middle")}}function kn(r,e){if(r&1){let t=j();c(0,"div",8),S("click",function(){let i=T(t).$implicit,o=C(2);return R(o.navigateToDetails(i.id))}),c(1,"div",9)(2,"div",10),w(3,"img",11),q(4,"entityImage"),q(5,"async"),m(),c(6,"div",12)(7,"div",13),g(8),c(9,"div",14),g(10),m()()()(),M(11,Rn,4,11,"div",15),q(12,"date"),m()}if(r&2){let t=e.$implicit,n=C(2);d(3),_("src",Ce(5,7,ae(4,4,n.ImageEntityType.Games,t.gameImageId)),Me),d(5),V(" ",t.name," "),d(2),V("Game: ",t.gameName,""),d(),_("ngIf",ae(12,9,t.startDate,n.DATE_TIME_FORMAT))}}function Dn(r,e){if(r&1&&(L(0),M(1,Tn,4,0,"div",3)(2,kn,13,12,"div",4),$()),r&2){let t=e.ngIf;d(),_("ngIf",t.length===0),d(),_("ngForOf",t)}}var gn=(()=>{let e=class e{constructor(n,i,o,s,l){this.router=n,this.menuTabsService=i,this.roomService=o,this.searchService=s,this.navigationService=l,this.ImageEntityType=xe,this.DATE_TIME_FORMAT=ce.DATE_TIME_FORMAT,this.menuTabsService.setActive(ee.MEEPLE)}ngOnInit(){this.roomList$=this.roomService.getList()}ngOnDestroy(){this.menuTabsService.resetData(),this.searchService.hideSearchForm()}handleSearchExpression(n){this.roomList$=this.roomService.getList(n)}navigateToDetails(n){this.navigationService.setPreviousUrl(G.MEEPLE_ROOM.DETAILS_BY_ID(n)),this.router.navigateByUrl(G.MEEPLE_ROOM.DETAILS_BY_ID(n))}navigateToCreateMeepleRoom(){this.router.navigateByUrl(G.MEEPLE_ROOM.CREATE)}};e.\u0275fac=function(i){return new(i||e)(h(K),h(te),h(H),h(rt),h(De))},e.\u0275cmp=A({type:e,selectors:[["app-find-meeple-manager"]],decls:4,vars:6,consts:[["header","Find Meeple",3,"addClicked","searchExpressionResult","withSearch","withAdd","withBottomLine"],[1,"wrapper_library"],[4,"ngIf"],["class","no_records",4,"ngIf"],["class","wrapper_library__border",3,"click",4,"ngFor","ngForOf"],[1,"no_records"],["src","/shared/assets/images/no-rooms-found.png","alt",""],[1,"first-header"],[1,"wrapper_library__border",3,"click"],[1,"wrapper_library__item"],[1,"wrapper_image"],["alt","Game Image",3,"src"],[1,"wrapper_info"],[1,"wrapper_title"],[1,"wrapper_description"],["class","chips",4,"ngIf"],[1,"chips"],[3,"color","text","size"]],template:function(i,o){i&1&&(c(0,"app-header",0),S("addClicked",function(){return o.navigateToCreateMeepleRoom()})("searchExpressionResult",function(l){return o.handleSearchExpression(l)}),m(),c(1,"section",1),M(2,Dn,3,2,"ng-container",2),q(3,"async"),m()),i&2&&(_("withSearch",!0)("withAdd",!0)("withBottomLine",!0),d(2),_("ngIf",Ce(3,4,o.roomList$)))},dependencies:[ye,Z,ot,st,Ie,me,Ee],styles:[".wrapper_library[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:85%;padding-bottom:7rem;margin:0 auto}.wrapper_library[_ngcontent-%COMP%]   .no_records[_ngcontent-%COMP%]{text-align:center;margin:2rem;font-size:1.5rem;display:flex;flex-direction:column;align-items:center}.wrapper_library[_ngcontent-%COMP%]   .no_records[_ngcontent-%COMP%]   .first-header[_ngcontent-%COMP%]{font-size:1.5rem;margin-bottom:.2rem}.wrapper_library[_ngcontent-%COMP%]   .no_records[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:15rem;width:15rem}.wrapper_library__border[_ngcontent-%COMP%]{border-bottom:.2rem solid #2b2e35;margin-top:.3rem}.wrapper_library__item[_ngcontent-%COMP%]{position:relative;display:flex;padding-bottom:.3rem;padding-top:.5rem}.wrapper_library__item[_ngcontent-%COMP%]   .wrapper_info[_ngcontent-%COMP%]   .wrapper_title[_ngcontent-%COMP%]{padding-left:1rem;font-size:large;padding-top:.2rem;align-self:baseline;word-break:break-all}.wrapper_library__item[_ngcontent-%COMP%]   .wrapper_info[_ngcontent-%COMP%]   .wrapper_title[_ngcontent-%COMP%]   .wrapper_description[_ngcontent-%COMP%]{padding-top:.5rem;font-size:1rem;color:#9b9b9b;word-break:break-all;margin-bottom:.2rem}.wrapper_library__item[_ngcontent-%COMP%]   .wrapper_image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:5rem;height:5rem;min-width:5rem;min-height:5rem;object-fit:cover;border-radius:20px;border:.1rem solid black}.wrapper_library[_ngcontent-%COMP%]   .chips[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:.75rem}"]});let r=e;return r})();var _n=(()=>{let e=class e{constructor(n,i,o,s){this.data=n,this.dialogRef=i,this.roomService=o,this.toastService=s}onDelete(){this.roomService.delete(this.data.id).subscribe({next:()=>{this.toastService.success({message:"Room successfully deleted",type:U.Success}),this.dialogRef.close(!0)},error:n=>{this.toastService.error({message:F.SomethingWrong,type:U.Error}),this.dialogRef.close(!0)}})}};e.\u0275fac=function(i){return new(i||e)(h(Te),h(Oe),h(H),h(X))},e.\u0275cmp=A({type:e,selectors:[["app-room-confirm-delete-dialog"]],decls:8,vars:0,consts:[[1,"dialog-container"],[1,"dialog-container__header","m-4"],["mat-dialog-close","",1,"btn","btn__small","btn-blue"],[1,"btn","btn__small","btn-red","btn-border-red",3,"click"]],template:function(i,o){i&1&&(c(0,"div",0)(1,"h3",1),g(2,"Delete Room?"),m(),c(3,"mat-dialog-actions")(4,"button",2),g(5,"Cancel"),m(),c(6,"button",3),S("click",function(){return o.onDelete()}),g(7," Delete "),m()()())},dependencies:[ke,Re],styles:[".dialog-container[_ngcontent-%COMP%]{color:#fff;background-color:#31313b}.dialog-container__header[_ngcontent-%COMP%]{margin:1rem}.dialog-container[_ngcontent-%COMP%]   mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:end}.dialog-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:.4rem}"]});let r=e;return r})();var fn=(()=>{let e=class e{constructor(n,i,o,s){this.data=n,this.dialogRef=i,this.roomService=o,this.toastService=s}onLeave(){this.roomService.leave(this.data.id).subscribe({next:()=>{this.toastService.success({message:"Room successfully left",type:U.Success}),this.dialogRef.close(!0)},error:n=>{this.toastService.error({message:F.SomethingWrong,type:U.Error}),this.dialogRef.close(!0)}})}};e.\u0275fac=function(i){return new(i||e)(h(Te),h(Oe),h(H),h(X))},e.\u0275cmp=A({type:e,selectors:[["app-room-confirm-leave-dialog"]],decls:8,vars:0,consts:[[1,"dialog-container"],[1,"dialog-container__header","m-4"],["mat-dialog-close","",1,"btn","btn__small","btn-blue"],[1,"btn","btn__small","btn-red","btn-border-red",3,"click"]],template:function(i,o){i&1&&(c(0,"div",0)(1,"h3",1),g(2,"Leave Room?"),m(),c(3,"mat-dialog-actions")(4,"button",2),g(5,"Cancel"),m(),c(6,"button",3),S("click",function(){return o.onLeave()}),g(7," Leave "),m()()())},dependencies:[ke,Re],styles:[".dialog-container[_ngcontent-%COMP%]{color:#fff;background-color:#31313b}.dialog-container__header[_ngcontent-%COMP%]{margin:1rem}.dialog-container[_ngcontent-%COMP%]   mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:end}.dialog-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:.4rem}"]});let r=e;return r})();function An(r,e){if(r&1){let t=j();L(0),c(1,"div",3),k(),c(2,"svg",4),S("click",function(i){T(t);let o=C(),s=Ft(3);return R(o.showMenu(i,s))}),w(3,"path",5),m()(),$()}}function Ln(r,e){if(r&1){let t=j();L(0),k(),c(1,"svg",4),S("click",function(){T(t);let i=C();return R(i.navigateToGameDetails())}),w(2,"path",6),m(),$()}}var _e=(()=>{let e=class e{constructor(n,i,o,s){this.router=n,this.dialog=i,this.authService=o,this.navigationService=s,this.fetchData=new jt,this.menuItems=new Qe([]),this.isMenuVisible=!1}ngOnInit(){this.updateMenuItems()}showMenu(n,i){n.stopPropagation(),i.toggleMenu()}updateMenuItems(){this.menuItems.next([{key:"update",label:"Update",isVisible:this.room&&this.room.createdBy===this.currentUserId()&&this.isCurrentUserParticipateInRoom},{key:"group-members",label:"Group Members",isVisible:!0},{key:"leave-room",label:"Leave Room",isVisible:this.room&&this.room.createdBy!==this.currentUserId()&&this.isCurrentUserParticipateInRoom,isRedTextOn:!0},{key:"delete-room",label:"Delete Room",isVisible:this.room&&this.room.createdBy===this.currentUserId()&&this.isCurrentUserParticipateInRoom,isRedTextOn:!0}])}currentUserId(){return this.authService.getUser?.id||""}onMenuOption(n,i){n==="group-members"?this.router.navigateByUrl(`/meeples/${this.room.id}/chat/members`):n==="update"?this.router.navigateByUrl(`/meeples/${this.room.id}/update`):n==="leave-room"?this.openLeaveRoomDialog():n==="delete-room"&&this.openDeleteRoomDialog(),this.isMenuVisible=!this.isMenuVisible}openDeleteRoomDialog(){this.dialog.open(_n,{data:{id:this.room.id}}).afterClosed().subscribe(i=>{i&&this.router.navigateByUrl("/meeples/find")})}openLeaveRoomDialog(){this.dialog.open(fn,{data:{id:this.room.id}}).afterClosed().subscribe(i=>{i&&this.fetchData.emit()})}navigateToGameDetails(){this.navigationService.setPreviousUrl(G.MEEPLE_ROOM.DETAILS_BY_ID(this.room.id)),this.router.navigateByUrl(`games/${this.room.gameId}/details`)}onClickOutside(n){let i=n.target;this.isMenuVisible===!0&&!i.closest(".menu_container")&&(this.isMenuVisible=!1)}};e.\u0275fac=function(i){return new(i||e)(h(K),h(it),h(he),h(De))},e.\u0275cmp=A({type:e,selectors:[["app-meeple-room-menu"]],hostBindings:function(i,o){i&1&&S("click",function(l){return o.onClickOutside(l)},!1,Nt)},inputs:{isCurrentUserParticipateInRoom:"isCurrentUserParticipateInRoom",room:"room"},outputs:{fetchData:"fetchData"},decls:4,vars:3,consts:[["controls",""],[4,"ngIf"],[3,"menuItemClick","menuItems"],[1,"menu_container"],["viewBox","0 -960 960 960",1,"icon",3,"click"],["d","M128-251.23v-66h704v66H128ZM128-448v-66h704v66H128Zm0-196.77v-66h704v66H128Z"],["d","M448-284h66v-236h-66v236Zm31.82-308.92q14.64 0 24.72-9.9 10.08-9.91 10.08-24.54 0-14.64-9.91-24.72-9.9-10.07-24.53-10.07-14.64 0-24.72 9.9-10.08 9.9-10.08 24.54 0 14.63 9.91 24.71 9.9 10.08 24.53 10.08ZM480.13-88q-81.31 0-152.89-30.86-71.57-30.86-124.52-83.76-52.95-52.9-83.83-124.42Q88-398.55 88-479.87q0-81.56 30.92-153.37 30.92-71.8 83.92-124.91 53-53.12 124.42-83.48Q398.67-872 479.87-872q81.55 0 153.35 30.34 71.79 30.34 124.92 83.42 53.13 53.08 83.49 124.84Q872-561.64 872-480.05q0 81.59-30.34 152.83-30.34 71.23-83.41 124.28-53.07 53.05-124.81 84Q561.7-88 480.13-88Zm-.13-66q136.51 0 231.26-94.74Q806-343.49 806-480t-94.74-231.26Q616.51-806 480-806t-231.26 94.74Q154-616.51 154-480t94.74 231.26Q343.49-154 480-154Zm0-326Z"]],template:function(i,o){if(i&1){let s=j();M(0,An,4,0,"ng-container",1)(1,Ln,3,0,"ng-container",1),c(2,"app-controls-menu",2,0),S("menuItemClick",function(p){return T(s),R(o.onMenuOption(p.value,p.event))}),m()}i&2&&(_("ngIf",o.isCurrentUserParticipateInRoom),d(),_("ngIf",!o.isCurrentUserParticipateInRoom),d(),_("menuItems",o.menuItems.asObservable()))},dependencies:[Z,en],styles:[".menu[_ngcontent-%COMP%]{position:fixed;right:2rem;top:4rem;background-color:#31313b;padding:1rem;z-index:1000}.menu[_ngcontent-%COMP%]   .red-text[_ngcontent-%COMP%]{color:#bf3c65}.menu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;margin:0;padding:0}.menu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:8px 12px;cursor:pointer}.menu[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.icon[_ngcontent-%COMP%]{width:3rem;height:3rem;fill:#75a0ff}"]});let r=e;return r})();function $n(r,e){if(r&1){let t=j();c(0,"app-meeple-room-menu",16),S("fetchData",function(){T(t);let i=C(2);return R(i.onLeaveCompleted())}),m()}if(r&2){let t=C(2);_("room",t.room)("isCurrentUserParticipateInRoom",t.isCurrentUserParticipateInRoom)}}function Un(r,e){if(r&1){let t=j();L(0),c(1,"div",17)(2,"div",18),S("click",function(){T(t);let i=C(2);return R(i.navigateToChat(i.room.id))}),c(3,"div",19),k(),c(4,"svg",20),w(5,"path",21),m()(),se(),c(6,"span",22),g(7,"Open Chat"),m()(),c(8,"div",18),S("click",function(){T(t);let i=C(2);return R(i.navigateToGameDetails(i.room.gameId))}),c(9,"div",19),k(),c(10,"svg",20),w(11,"path",23),m()(),se(),c(12,"span",22),g(13,"See Game Details"),m()()(),$()}}function Bn(r,e){if(r&1){let t=j();c(0,"button",28),S("click",function(){T(t);let i=C(3);return R(i.onJoinRoom())}),g(1," Join the Room "),m()}}function jn(r,e){r&1&&(c(0,"span",29),g(1," Sorry, the room is full! "),m())}function Nn(r,e){if(r&1&&(c(0,"span",30),g(1),m()),r&2){let t=C(3);d(),V(" ",t.errorMessage," ")}}function Hn(r,e){if(r&1&&(L(0),c(1,"div",24),M(2,Bn,2,0,"button",25)(3,jn,2,0,"span",26)(4,Nn,2,1,"span",27),m(),$()),r&2){let t=C(2);d(2),_("ngIf",!t.errorMessage&&t.room.joinedParticipants<t.room.maxParticipants),d(),_("ngIf",!t.errorMessage&&t.room.joinedParticipants===t.room.maxParticipants),d(),_("ngIf",t.errorMessage)}}function Fn(r,e){if(r&1){let t=j();c(0,"div",1)(1,"div",2)(2,"span",3),S("click",function(){T(t);let i=C();return R(i.backNavigateBtn())}),m(),c(3,"span",4),g(4),m(),M(5,$n,1,2,"app-meeple-room-menu",5),m(),c(6,"div",6),w(7,"img",7),q(8,"entityImage"),q(9,"async"),m(),c(10,"div",8),g(11),m(),c(12,"div",9)(13,"div",10)(14,"span"),g(15,"joined"),m(),w(16,"app-chip",11),m(),c(17,"div",10),w(18,"app-chip",12),q(19,"date"),c(20,"span"),g(21,"date"),m()(),c(22,"div",10)(23,"span"),g(24,"max"),m(),w(25,"app-chip",13),m(),c(26,"div",10),w(27,"app-chip",14),q(28,"date"),c(29,"span"),g(30,"time"),m()()(),M(31,Un,14,0,"ng-container",15)(32,Hn,5,3,"ng-container",15),m()}if(r&2){let t=C();d(4),z(t.room.name),d(),_("ngIf",t.room),d(2),_("src",Ce(9,13,ae(8,10,t.ImageEntityType.Games,t.room.gameImageId)),Me),d(4),V("from: ",t.room.username,""),d(5),_("text",t.room.joinedParticipants.toString()),d(2),Tt("text",ae(19,15,t.room.startDate,t.DATE_FORMAT)),d(7),_("text",t.room.maxParticipants.toString()),d(2),Tt("text",ae(28,18,t.room.startDate,t.TIME_FORMAT)),d(4),_("ngIf",t.isCurrentUserParticipateInRoom),d(),_("ngIf",!t.isCurrentUserParticipateInRoom)}}var vn=(()=>{let e=class e{constructor(n,i,o,s,l,p){this.roomService=n,this.activeRoute=i,this.authService=o,this.menuTabsService=s,this.router=l,this.navigationService=p,this.isCurrentUserParticipateInRoom=!1,this.errorMessage=null,this.DATE_FORMAT=ce.DATE_FORMAT,this.TIME_FORMAT=ce.TIME_FORMAT,this.ImageEntityType=xe,this.menuTabsService.setActive(ee.MEEPLE)}ngOnDestroy(){this.menuTabsService.resetData()}ngOnInit(){this.activeRoute.params.subscribe(n=>{this.roomId=n.id,this.fetchData()})}backNavigateBtn(){this.router.navigateByUrl(G.MEEPLE_ROOM.FIND)}navigateToGameDetails(n){this.navigationService.setPreviousUrl(G.MEEPLE_ROOM.DETAILS_BY_ID(this.roomId)),this.router.navigateByUrl(G.GAMES.DETAILS(n))}navigateToChat(n){this.router.navigateByUrl(G.MEEPLE_ROOM.CHAT_ROOM_BY_ID(n))}onJoinRoom(){this.roomService.join(this.roomId).subscribe({next:()=>this.fetchData(),error:n=>{n.error.detail&&(this.errorMessage=n.error.detail)}})}onLeaveCompleted(){this.fetchData()}currentUserId(){return this.authService.getUser?.id||""}fetchData(){oe([this.roomService.getById(this.roomId),this.roomService.checkUserParticipateInRoom(this.roomId)]).subscribe({next:([n,i])=>{this.room=n,this.isCurrentUserParticipateInRoom=n.createdBy===this.authService.getUser?.id||i,this.menu&&(this.menu.room=this.room,this.menu.isCurrentUserParticipateInRoom=this.isCurrentUserParticipateInRoom,this.menu.updateMenuItems())}})}};e.\u0275fac=function(i){return new(i||e)(h(H),h(de),h(he),h(te),h(K),h(De))},e.\u0275cmp=A({type:e,selectors:[["app-meeple-room-details"]],viewQuery:function(i,o){if(i&1&&Ue(_e,5),i&2){let s;Be(s=je())&&(o.menu=s.first)}},decls:1,vars:1,consts:[["class","wrapper_container",4,"ngIf"],[1,"wrapper_container"],[1,"wrapper_icons"],[1,"arrow","left",3,"click"],[1,"header_name"],[3,"room","isCurrentUserParticipateInRoom","fetchData",4,"ngIf"],[1,"wrapper_image"],["alt","",3,"src"],[1,"wrapper_header"],[1,"wrapper_chips"],[1,"wrapper_chips__detail"],["size","small","color","orange",3,"text"],["size","small","color","blue",3,"text"],["size","small","color","red",3,"text"],["size","small","color","yellow",3,"text"],[4,"ngIf"],[3,"fetchData","room","isCurrentUserParticipateInRoom"],[1,"wrapper_tabs"],[1,"wrapper_tabs__tab",3,"click"],[1,"info"],["viewBox","0 -960 960 960"],["d","M244-420h310v-40H244v40Zm0-135h472v-40H244v40Zm0-135h472v-40H244v40ZM88-114.92v-678.46q0-38.35 26.14-64.48Q140.27-884 178.62-884h602.76q38.35 0 64.48 26.14Q872-831.73 872-793.38v438.76q0 38.35-26.14 64.48Q819.73-264 781.38-264h-544.3L88-114.92ZM210-330h571.38q9.24 0 16.93-7.69 7.69-7.69 7.69-16.93v-438.76q0-9.24-7.69-16.93-7.69-7.69-16.93-7.69H178.62q-9.24 0-16.93 7.69-7.69 7.69-7.69 16.93v520.15L210-330Zm-56 0v-488 488Z"],[1,"wrapper_tabs__tab-header"],["d","M448-284h66v-236h-66v236Zm31.82-308.92q14.64 0 24.72-9.9 10.08-9.91 10.08-24.54 0-14.64-9.91-24.72-9.9-10.07-24.53-10.07-14.64 0-24.72 9.9-10.08 9.9-10.08 24.54 0 14.63 9.91 24.71 9.9 10.08 24.53 10.08ZM480.13-88q-81.31 0-152.89-30.86-71.57-30.86-124.52-83.76-52.95-52.9-83.83-124.42Q88-398.55 88-479.87q0-81.56 30.92-153.37 30.92-71.8 83.92-124.91 53-53.12 124.42-83.48Q398.67-872 479.87-872q81.55 0 153.35 30.34 71.79 30.34 124.92 83.42 53.13 53.08 83.49 124.84Q872-561.64 872-480.05q0 81.59-30.34 152.83-30.34 71.23-83.41 124.28-53.07 53.05-124.81 84Q561.7-88 480.13-88Zm-.13-66q136.51 0 231.26-94.74Q806-343.49 806-480t-94.74-231.26Q616.51-806 480-806t-231.26 94.74Q154-616.51 154-480t94.74 231.26Q343.49-154 480-154Zm0-326Z"],[1,"wrapper_btn"],["class","btn btn-green",3,"click",4,"ngIf"],["class","full_room_message",4,"ngIf"],["class","errors",4,"ngIf"],[1,"btn","btn-green",3,"click"],[1,"full_room_message"],[1,"errors"]],template:function(i,o){i&1&&M(0,Fn,33,21,"div",0),i&2&&_("ngIf",o.room)},dependencies:[Z,st,_e,Ie,me,Ee],styles:['.wrapper_container[_ngcontent-%COMP%]{overflow:auto;margin-bottom:2.5rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_image[_ngcontent-%COMP%]{text-align:center;margin:1rem 0}.wrapper_container[_ngcontent-%COMP%]   .wrapper_image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:10rem;height:10rem;object-fit:cover;border-radius:20px}.wrapper_container[_ngcontent-%COMP%]   .wrapper_header[_ngcontent-%COMP%]{text-align:center;font-size:1.5rem;max-width:100%;margin:1rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_chips[_ngcontent-%COMP%]{background-color:#31313b;display:flex;flex-wrap:wrap;align-items:center}.wrapper_container[_ngcontent-%COMP%]   .wrapper_chips__detail[_ngcontent-%COMP%]{margin:.5rem;display:flex;justify-content:center;width:45%;align-items:center}.wrapper_container[_ngcontent-%COMP%]   .wrapper_chips__detail[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:0 .5rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_btn[_ngcontent-%COMP%]{margin:6rem 0;text-align:center}.wrapper_container[_ngcontent-%COMP%]   .wrapper_tabs[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;margin-top:2rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_tabs__tab[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:8rem;height:8rem;border-radius:.5rem;background-color:#31313b;color:#9b9b9b}.wrapper_container[_ngcontent-%COMP%]   .wrapper_tabs__tab-header[_ngcontent-%COMP%]{margin:0 .75rem;font-weight:600;text-align:center}.wrapper_container[_ngcontent-%COMP%]   .wrapper_tabs__tab[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{display:flex;justify-content:center}.wrapper_container[_ngcontent-%COMP%]   .wrapper_tabs__tab[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:3.5rem;height:3.5rem;margin:.7rem;fill:#9b9b9b}.wrapper_container[_ngcontent-%COMP%]   .wrapper_icons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:1rem 1rem 0;align-items:center}.wrapper_container[_ngcontent-%COMP%]   .wrapper_icons[_ngcontent-%COMP%]   .header_name[_ngcontent-%COMP%]{font-size:1.5rem;padding-top:1rem;padding-bottom:.5rem;word-wrap:break-word;width:70%;text-align:center}.wrapper_container[_ngcontent-%COMP%]   .wrapper_icons[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{width:3rem;height:3rem;display:inline-block;position:relative;border:.1rem solid #98989d;border-radius:2.5rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_icons[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:before{content:"";display:block;width:.75rem;height:.75rem;top:65%;left:63%;border-style:solid;border-color:#98989d;border-width:.2rem .2rem 0 0;position:absolute;transform-origin:50% 50%}.wrapper_container[_ngcontent-%COMP%]   .wrapper_icons[_ngcontent-%COMP%]   .arrow.left[_ngcontent-%COMP%]:before{transform:rotate(-135deg);margin:-.9rem 0 0 -.6rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_btn[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:3rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_btn[_ngcontent-%COMP%]   .full_room_message[_ngcontent-%COMP%]{font-size:1.5rem}']});let r=e;return r})();var W=class extends Error{constructor(e,t){let n=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=n}},fe=class extends Error{constructor(e="A timeout occurred."){let t=new.target.prototype;super(e),this.__proto__=t}},B=class extends Error{constructor(e="An abort occurred."){let t=new.target.prototype;super(e),this.__proto__=t}},mt=class extends Error{constructor(e,t){let n=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=n}},pt=class extends Error{constructor(e,t){let n=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=n}},dt=class extends Error{constructor(e,t){let n=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=n}},qe=class extends Error{constructor(e){let t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}},ht=class extends Error{constructor(e,t){let n=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=n}};var Ae=class{constructor(e,t,n){this.statusCode=e,this.statusText=t,this.content=n}},ne=class{get(e,t){return this.send(le(y({},t),{method:"GET",url:e}))}post(e,t){return this.send(le(y({},t),{method:"POST",url:e}))}delete(e,t){return this.send(le(y({},t),{method:"DELETE",url:e}))}getCookieString(e){return""}};var a=function(r){return r[r.Trace=0]="Trace",r[r.Debug=1]="Debug",r[r.Information=2]="Information",r[r.Warning=3]="Warning",r[r.Error=4]="Error",r[r.Critical=5]="Critical",r[r.None=6]="None",r}(a||{});var ie=class{constructor(){}log(e,t){}};ie.instance=new ie;var qn="8.0.7",I=class{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,n){if(!(e in t))throw new Error(`Unknown ${n} value: ${e}.`)}},P=class r{static get isBrowser(){return!r.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!r.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!r.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}};function ue(r,e){let t="";return J(r)?(t=`Binary data of length ${r.byteLength}`,e&&(t+=`. Content: '${Vn(r)}'`)):typeof r=="string"&&(t=`String data of length ${r.length}`,e&&(t+=`. Content: '${r}'`)),t}function Vn(r){let e=new Uint8Array(r),t="";return e.forEach(n=>{let i=n<16?"0":"";t+=`0x${i}${n.toString(16)} `}),t.substr(0,t.length-1)}function J(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function _t(r,e,t,n,i,o){return b(this,null,function*(){let s={},[l,p]=re();s[l]=p,r.log(a.Trace,`(${e} transport) sending data. ${ue(i,o.logMessageContent)}.`);let f=J(i)?"arraybuffer":"text",v=yield t.post(n,{content:i,headers:y(y({},s),o.headers),responseType:f,timeout:o.timeout,withCredentials:o.withCredentials});r.log(a.Trace,`(${e} transport) request complete. Response status: ${v.statusCode}.`)})}function Cn(r){return r===void 0?new be(a.Information):r===null?ie.instance:r.log!==void 0?r:new be(r)}var gt=class{constructor(e,t){this._subject=e,this._observer=t}dispose(){let e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}},be=class{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){let n=`[${new Date().toISOString()}] ${a[e]}: ${t}`;switch(e){case a.Critical:case a.Error:this.out.error(n);break;case a.Warning:this.out.warn(n);break;case a.Information:this.out.info(n);break;default:this.out.log(n);break}}}};function re(){let r="X-SignalR-User-Agent";return P.isNode&&(r="User-Agent"),[r,Gn(qn,Wn(),zn(),Qn())]}function Gn(r,e,t,n){let i="Microsoft SignalR/",o=r.split(".");return i+=`${o[0]}.${o[1]}`,i+=` (${r}; `,e&&e!==""?i+=`${e}; `:i+="Unknown OS; ",i+=`${t}`,n?i+=`; ${n}`:i+="; Unknown Runtime Version",i+=")",i}function Wn(){if(P.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function Qn(){if(P.isNode)return process.versions.node}function zn(){return P.isNode?"NodeJS":"Browser"}function ft(r){return r.stack?r.stack:r.message?r.message:`${r}`}function bn(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}var ut=class extends ne{constructor(e){if(super(),this._logger=e,typeof fetch>"u"||P.isNode){let t=typeof __webpack_require__=="function"?__non_webpack_require__:Se;this._jar=new(t("tough-cookie")).CookieJar,typeof fetch>"u"?this._fetchType=t("node-fetch"):this._fetchType=fetch,this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(bn());if(typeof AbortController>"u"){let t=typeof __webpack_require__=="function"?__non_webpack_require__:Se;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}send(e){return b(this,null,function*(){if(e.abortSignal&&e.abortSignal.aborted)throw new B;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");let t=new this._abortControllerType,n;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),n=new B});let i=null;if(e.timeout){let p=e.timeout;i=setTimeout(()=>{t.abort(),this._logger.log(a.Warning,"Timeout from HTTP request."),n=new fe},p)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},J(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");let o;try{o=yield this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:y({"X-Requested-With":"XMLHttpRequest"},e.headers),method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(p){throw n||(this._logger.log(a.Warning,`Error from HTTP request. ${p}.`),p)}finally{i&&clearTimeout(i),e.abortSignal&&(e.abortSignal.onabort=null)}if(!o.ok){let p=yield wn(o,"text");throw new W(p||o.statusText,o.status)}let l=yield wn(o,e.responseType);return new Ae(o.status,o.statusText,l)})}getCookieString(e){let t="";return P.isNode&&this._jar&&this._jar.getCookies(e,(n,i)=>t=i.join("; ")),t}};function wn(r,e){let t;switch(e){case"arraybuffer":t=r.arrayBuffer();break;case"text":t=r.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:t=r.text();break}return t}var vt=class extends ne{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new B):e.method?e.url?new Promise((t,n)=>{let i=new XMLHttpRequest;i.open(e.method,e.url,!0),i.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,i.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(J(e.content)?i.setRequestHeader("Content-Type","application/octet-stream"):i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));let o=e.headers;o&&Object.keys(o).forEach(s=>{i.setRequestHeader(s,o[s])}),e.responseType&&(i.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{i.abort(),n(new B)}),e.timeout&&(i.timeout=e.timeout),i.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),i.status>=200&&i.status<300?t(new Ae(i.status,i.statusText,i.response||i.responseText)):n(new W(i.response||i.responseText||i.statusText,i.status))},i.onerror=()=>{this._logger.log(a.Warning,`Error from HTTP request. ${i.status}: ${i.statusText}.`),n(new W(i.statusText,i.status))},i.ontimeout=()=>{this._logger.log(a.Warning,"Timeout from HTTP request."),n(new fe)},i.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}};var Ct=class extends ne{constructor(e){if(super(),typeof fetch<"u"||P.isNode)this._httpClient=new ut(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new vt(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new B):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}};var Q=class r{static write(e){return`${e}${r.RecordSeparator}`}static parse(e){if(e[e.length-1]!==r.RecordSeparator)throw new Error("Message is incomplete.");let t=e.split(r.RecordSeparator);return t.pop(),t}};Q.RecordSeparatorCode=30;Q.RecordSeparator=String.fromCharCode(Q.RecordSeparatorCode);var bt=class{writeHandshakeRequest(e){return Q.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,n;if(J(e)){let l=new Uint8Array(e),p=l.indexOf(Q.RecordSeparatorCode);if(p===-1)throw new Error("Message is incomplete.");let f=p+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(l.slice(0,f))),n=l.byteLength>f?l.slice(f).buffer:null}else{let l=e,p=l.indexOf(Q.RecordSeparator);if(p===-1)throw new Error("Message is incomplete.");let f=p+1;t=l.substring(0,f),n=l.length>f?l.substring(f):null}let i=Q.parse(t),o=JSON.parse(i[0]);if(o.type)throw new Error("Expected a handshake response from the server.");return[n,o]}};var u=function(r){return r[r.Invocation=1]="Invocation",r[r.StreamItem=2]="StreamItem",r[r.Completion=3]="Completion",r[r.StreamInvocation=4]="StreamInvocation",r[r.CancelInvocation=5]="CancelInvocation",r[r.Ping=6]="Ping",r[r.Close=7]="Close",r[r.Ack=8]="Ack",r[r.Sequence=9]="Sequence",r}(u||{});var wt=class{constructor(){this.observers=[]}next(e){for(let t of this.observers)t.next(e)}error(e){for(let t of this.observers)t.error&&t.error(e)}complete(){for(let e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new gt(this,e)}};var St=class{constructor(e,t,n){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=n}_send(e){return b(this,null,function*(){let t=this._protocol.writeMessage(e),n=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let i=()=>{},o=()=>{};J(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(n=new Promise((s,l)=>{i=s,o=l})),this._messages.push(new At(t,this._totalMessageCount,i,o))}try{this._reconnectInProgress||(yield this._connection.send(t))}catch{this._disconnected()}yield n})}_ack(e){let t=-1;for(let n=0;n<this._messages.length;n++){let i=this._messages[n];if(i._id<=e.sequenceId)t=n,J(i._message)?this._bufferedByteCount-=i._message.byteLength:this._bufferedByteCount-=i._message.length,i._resolver();else if(this._bufferedByteCount<this._bufferSize)i._resolver();else break}t!==-1&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type!==u.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;let t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){if(e.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}_resend(){return b(this,null,function*(){let e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;yield this._connection.send(this._protocol.writeMessage({type:u.Sequence,sequenceId:e}));let t=this._messages;for(let n of t)yield this._connection.send(n._message);this._reconnectInProgress=!1})}_dispose(e){e??(e=new Error("Unable to reconnect to server."));for(let t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case u.Invocation:case u.StreamItem:case u.Completion:case u.StreamInvocation:case u.CancelInvocation:return!0;case u.Close:case u.Sequence:case u.Ping:case u.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(()=>b(this,null,function*(){try{this._reconnectInProgress||(yield this._connection.send(this._protocol.writeMessage({type:u.Ack,sequenceId:this._latestReceivedSequenceId})))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0}),1e3))}},At=class{constructor(e,t,n,i){this._message=e,this._id=t,this._resolver=n,this._rejector=i}};var Zn=30*1e3,Yn=15*1e3,Jn=1e5,x=function(r){return r.Disconnected="Disconnected",r.Connecting="Connecting",r.Connected="Connected",r.Disconnecting="Disconnecting",r.Reconnecting="Reconnecting",r}(x||{}),Mt=class r{static create(e,t,n,i,o,s,l){return new r(e,t,n,i,o,s,l)}constructor(e,t,n,i,o,s,l){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(a.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},I.isRequired(e,"connection"),I.isRequired(t,"logger"),I.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=o??Zn,this.keepAliveIntervalInMilliseconds=s??Yn,this._statefulReconnectBufferSize=l??Jn,this._logger=t,this._protocol=n,this.connection=e,this._reconnectPolicy=i,this._handshakeProtocol=new bt,this.connection.onreceive=p=>this._processIncomingData(p),this.connection.onclose=p=>this._connectionClosed(p),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=x.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:u.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==x.Disconnected&&this._connectionState!==x.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}_startWithStateTransitions(){return b(this,null,function*(){if(this._connectionState!==x.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=x.Connecting,this._logger.log(a.Debug,"Starting HubConnection.");try{yield this._startInternal(),P.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=x.Connected,this._connectionStarted=!0,this._logger.log(a.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=x.Disconnected,this._logger.log(a.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}})}_startInternal(){return b(this,null,function*(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;let e=new Promise((t,n)=>{this._handshakeResolver=t,this._handshakeRejecter=n});yield this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);let n={protocol:this._protocol.name,version:t};if(this._logger.log(a.Debug,"Sending handshake request."),yield this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(n)),this._logger.log(a.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),yield e,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new St(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||(yield this._sendMessage(this._cachedPingMessage))}catch(t){throw this._logger.log(a.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),yield this.connection.stop(t),t}})}stop(){return b(this,null,function*(){let e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),yield this._stopPromise;try{yield e}catch{}})}_stopInternal(e){if(this._connectionState===x.Disconnected)return this._logger.log(a.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===x.Disconnecting)return this._logger.log(a.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;let t=this._connectionState;return this._connectionState=x.Disconnecting,this._logger.log(a.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(a.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===x.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new B("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}_sendCloseMessage(){return b(this,null,function*(){try{yield this._sendWithProtocol(this._createCloseMessage())}catch{}})}stream(e,...t){let[n,i]=this._replaceStreamingParams(t),o=this._createStreamInvocation(e,t,i),s,l=new wt;return l.cancelCallback=()=>{let p=this._createCancelInvocation(o.invocationId);return delete this._callbacks[o.invocationId],s.then(()=>this._sendWithProtocol(p))},this._callbacks[o.invocationId]=(p,f)=>{if(f){l.error(f);return}else p&&(p.type===u.Completion?p.error?l.error(new Error(p.error)):l.complete():l.next(p.item))},s=this._sendWithProtocol(o).catch(p=>{l.error(p),delete this._callbacks[o.invocationId]}),this._launchStreams(n,s),l}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){let[n,i]=this._replaceStreamingParams(t),o=this._sendWithProtocol(this._createInvocation(e,t,!0,i));return this._launchStreams(n,o),o}invoke(e,...t){let[n,i]=this._replaceStreamingParams(t),o=this._createInvocation(e,t,!1,i);return new Promise((l,p)=>{this._callbacks[o.invocationId]=(v,N)=>{if(N){p(N);return}else v&&(v.type===u.Completion?v.error?p(new Error(v.error)):l(v.result):p(new Error(`Unexpected message type: ${v.type}`)))};let f=this._sendWithProtocol(o).catch(v=>{p(v),delete this._callbacks[o.invocationId]});this._launchStreams(n,f)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();let n=this._methods[e];if(n)if(t){let i=n.indexOf(t);i!==-1&&(n.splice(i,1),n.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){let t=this._protocol.parseMessages(e,this._logger);for(let n of t)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(n)))switch(n.type){case u.Invocation:this._invokeClientMethod(n).catch(i=>{this._logger.log(a.Error,`Invoke client method threw error: ${ft(i)}`)});break;case u.StreamItem:case u.Completion:{let i=this._callbacks[n.invocationId];if(i){n.type===u.Completion&&delete this._callbacks[n.invocationId];try{i(n)}catch(o){this._logger.log(a.Error,`Stream callback threw error: ${ft(o)}`)}}break}case u.Ping:break;case u.Close:{this._logger.log(a.Information,"Close message received from server.");let i=n.error?new Error("Server returned an error on close: "+n.error):void 0;n.allowReconnect===!0?this.connection.stop(i):this._stopPromise=this._stopInternal(i);break}case u.Ack:this._messageBuffer&&this._messageBuffer._ack(n);break;case u.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(n);break;default:this._logger.log(a.Warning,`Invalid message type: ${n.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,n;try{[n,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(i){let o="Error parsing handshake response: "+i;this._logger.log(a.Error,o);let s=new Error(o);throw this._handshakeRejecter(s),s}if(t.error){let i="Server returned handshake error: "+t.error;this._logger.log(a.Error,i);let o=new Error(i);throw this._handshakeRejecter(o),o}else this._logger.log(a.Debug,"Server handshake complete.");return this._handshakeResolver(),n}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(()=>b(this,null,function*(){if(this._connectionState===x.Connected)try{yield this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}}),e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}_invokeClientMethod(e){return b(this,null,function*(){let t=e.target.toLowerCase(),n=this._methods[t];if(!n){this._logger.log(a.Warning,`No client method with the name '${t}' found.`),e.invocationId&&(this._logger.log(a.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),yield this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}let i=n.slice(),o=!!e.invocationId,s,l,p;for(let f of i)try{let v=s;s=yield f.apply(this,e.arguments),o&&s&&v&&(this._logger.log(a.Error,`Multiple results provided for '${t}'. Sending error to server.`),p=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),l=void 0}catch(v){l=v,this._logger.log(a.Error,`A callback for the method '${t}' threw error '${v}'.`)}p?yield this._sendWithProtocol(p):o?(l?p=this._createCompletionMessage(e.invocationId,`${l}`,null):s!==void 0?p=this._createCompletionMessage(e.invocationId,null,s):(this._logger.log(a.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),p=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),yield this._sendWithProtocol(p)):s&&this._logger.log(a.Error,`Result given for '${t}' method but server is not expecting a result.`)})}_connectionClosed(e){this._logger.log(a.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new B("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===x.Disconnecting?this._completeClose(e):this._connectionState===x.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===x.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=x.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e??new Error("Connection closed.")),this._messageBuffer=void 0),P.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(a.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}_reconnect(e){return b(this,null,function*(){let t=Date.now(),n=0,i=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),o=this._getNextRetryDelay(n++,0,i);if(o===null){this._logger.log(a.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=x.Reconnecting,e?this._logger.log(a.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(a.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(s=>s.apply(this,[e]))}catch(s){this._logger.log(a.Error,`An onreconnecting callback called with error '${e}' threw error '${s}'.`)}if(this._connectionState!==x.Reconnecting){this._logger.log(a.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;o!==null;){if(this._logger.log(a.Information,`Reconnect attempt number ${n} will start in ${o} ms.`),yield new Promise(s=>{this._reconnectDelayHandle=setTimeout(s,o)}),this._reconnectDelayHandle=void 0,this._connectionState!==x.Reconnecting){this._logger.log(a.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(yield this._startInternal(),this._connectionState=x.Connected,this._logger.log(a.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(s=>s.apply(this,[this.connection.connectionId]))}catch(s){this._logger.log(a.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${s}'.`)}return}catch(s){if(this._logger.log(a.Information,`Reconnect attempt failed because of error '${s}'.`),this._connectionState!==x.Reconnecting){this._logger.log(a.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===x.Disconnecting&&this._completeClose();return}i=s instanceof Error?s:new Error(s.toString()),o=this._getNextRetryDelay(n++,Date.now()-t,i)}}this._logger.log(a.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${n} failed attempts. Connection disconnecting.`),this._completeClose()})}_getNextRetryDelay(e,t,n){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:n})}catch(i){return this._logger.log(a.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${i}'.`),null}}_cancelCallbacksWithError(e){let t=this._callbacks;this._callbacks={},Object.keys(t).forEach(n=>{let i=t[n];try{i(null,e)}catch(o){this._logger.log(a.Error,`Stream 'error' callback called with '${e}' threw error: ${ft(o)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,n,i){if(n)return i.length!==0?{arguments:t,streamIds:i,target:e,type:u.Invocation}:{arguments:t,target:e,type:u.Invocation};{let o=this._invocationId;return this._invocationId++,i.length!==0?{arguments:t,invocationId:o.toString(),streamIds:i,target:e,type:u.Invocation}:{arguments:t,invocationId:o.toString(),target:e,type:u.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(let n in e)e[n].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n)))},error:i=>{let o;i instanceof Error?o=i.message:i&&i.toString?o=i.toString():o="Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n,o)))},next:i=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(n,i)))}})}}_replaceStreamingParams(e){let t=[],n=[];for(let i=0;i<e.length;i++){let o=e[i];if(this._isObservable(o)){let s=this._invocationId;this._invocationId++,t[s]=o,n.push(s.toString()),e.splice(i,1)}}return[t,n]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,n){let i=this._invocationId;return this._invocationId++,n.length!==0?{arguments:t,invocationId:i.toString(),streamIds:n,target:e,type:u.StreamInvocation}:{arguments:t,invocationId:i.toString(),target:e,type:u.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:u.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:u.StreamItem}}_createCompletionMessage(e,t,n){return t?{error:t,invocationId:e,type:u.Completion}:{invocationId:e,result:n,type:u.Completion}}_createCloseMessage(){return{type:u.Close}}};var Kn=[0,2e3,1e4,3e4,null],Ve=class{constructor(e){this._retryDelays=e!==void 0?[...e,null]:Kn}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}};var we=(()=>{class r{}return r.Authorization="Authorization",r.Cookie="Cookie",r})();var yt=class extends ne{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}send(e){return b(this,null,function*(){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=yield this._accessTokenFactory()),this._setAuthorizationHeader(e);let n=yield this._innerClient.send(e);return t&&n.statusCode===401&&this._accessTokenFactory?(this._accessToken=yield this._accessTokenFactory(),this._setAuthorizationHeader(e),yield this._innerClient.send(e)):n})}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[we.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[we.Authorization]&&delete e.headers[we.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}};var D=function(r){return r[r.None=0]="None",r[r.WebSockets=1]="WebSockets",r[r.ServerSentEvents=2]="ServerSentEvents",r[r.LongPolling=4]="LongPolling",r}(D||{}),O=function(r){return r[r.Text=1]="Text",r[r.Binary=2]="Binary",r}(O||{});var It=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};var Ge=class{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,n){this._httpClient=e,this._logger=t,this._pollAbort=new It,this._options=n,this._running=!1,this.onreceive=null,this.onclose=null}connect(e,t){return b(this,null,function*(){if(I.isRequired(e,"url"),I.isRequired(t,"transferFormat"),I.isIn(t,O,"transferFormat"),this._url=e,this._logger.log(a.Trace,"(LongPolling transport) Connecting."),t===O.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");let[n,i]=re(),o=y({[n]:i},this._options.headers),s={abortSignal:this._pollAbort.signal,headers:o,timeout:1e5,withCredentials:this._options.withCredentials};t===O.Binary&&(s.responseType="arraybuffer");let l=`${e}&_=${Date.now()}`;this._logger.log(a.Trace,`(LongPolling transport) polling: ${l}.`);let p=yield this._httpClient.get(l,s);p.statusCode!==200?(this._logger.log(a.Error,`(LongPolling transport) Unexpected response code: ${p.statusCode}.`),this._closeError=new W(p.statusText||"",p.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,s)})}_poll(e,t){return b(this,null,function*(){try{for(;this._running;)try{let n=`${e}&_=${Date.now()}`;this._logger.log(a.Trace,`(LongPolling transport) polling: ${n}.`);let i=yield this._httpClient.get(n,t);i.statusCode===204?(this._logger.log(a.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):i.statusCode!==200?(this._logger.log(a.Error,`(LongPolling transport) Unexpected response code: ${i.statusCode}.`),this._closeError=new W(i.statusText||"",i.statusCode),this._running=!1):i.content?(this._logger.log(a.Trace,`(LongPolling transport) data received. ${ue(i.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(i.content)):this._logger.log(a.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(n){this._running?n instanceof fe?this._logger.log(a.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=n,this._running=!1):this._logger.log(a.Trace,`(LongPolling transport) Poll errored after shutdown: ${n.message}`)}}finally{this._logger.log(a.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}})}send(e){return b(this,null,function*(){return this._running?_t(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))})}stop(){return b(this,null,function*(){this._logger.log(a.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{yield this._receiving,this._logger.log(a.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);let e={},[t,n]=re();e[t]=n;let i={headers:y(y({},e),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials},o;try{yield this._httpClient.delete(this._url,i)}catch(s){o=s}o?o instanceof W&&(o.statusCode===404?this._logger.log(a.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(a.Trace,`(LongPolling transport) Error sending a DELETE request: ${o}`)):this._logger.log(a.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(a.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}})}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(a.Trace,e),this.onclose(this._closeError)}}};var Pt=class{constructor(e,t,n,i){this._httpClient=e,this._accessToken=t,this._logger=n,this._options=i,this.onreceive=null,this.onclose=null}connect(e,t){return b(this,null,function*(){return I.isRequired(e,"url"),I.isRequired(t,"transferFormat"),I.isIn(t,O,"transferFormat"),this._logger.log(a.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((n,i)=>{let o=!1;if(t!==O.Text){i(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let s;if(P.isBrowser||P.isWebWorker)s=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{let l=this._httpClient.getCookieString(e),p={};p.Cookie=l;let[f,v]=re();p[f]=v,s=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:y(y({},p),this._options.headers)})}try{s.onmessage=l=>{if(this.onreceive)try{this._logger.log(a.Trace,`(SSE transport) data received. ${ue(l.data,this._options.logMessageContent)}.`),this.onreceive(l.data)}catch(p){this._close(p);return}},s.onerror=l=>{o?this._close():i(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},s.onopen=()=>{this._logger.log(a.Information,`SSE connected to ${this._url}`),this._eventSource=s,o=!0,n()}}catch(l){i(l);return}})})}send(e){return b(this,null,function*(){return this._eventSource?_t(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))})}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}};var xt=class{constructor(e,t,n,i,o,s){this._logger=n,this._accessTokenFactory=t,this._logMessageContent=i,this._webSocketConstructor=o,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=s}connect(e,t){return b(this,null,function*(){I.isRequired(e,"url"),I.isRequired(t,"transferFormat"),I.isIn(t,O,"transferFormat"),this._logger.log(a.Trace,"(WebSockets transport) Connecting.");let n;return this._accessTokenFactory&&(n=yield this._accessTokenFactory()),new Promise((i,o)=>{e=e.replace(/^http/,"ws");let s,l=this._httpClient.getCookieString(e),p=!1;if(P.isNode||P.isReactNative){let f={},[v,N]=re();f[v]=N,n&&(f[we.Authorization]=`Bearer ${n}`),l&&(f[we.Cookie]=l),s=new this._webSocketConstructor(e,void 0,{headers:y(y({},f),this._headers)})}else n&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(n)}`);s||(s=new this._webSocketConstructor(e)),t===O.Binary&&(s.binaryType="arraybuffer"),s.onopen=f=>{this._logger.log(a.Information,`WebSocket connected to ${e}.`),this._webSocket=s,p=!0,i()},s.onerror=f=>{let v=null;typeof ErrorEvent<"u"&&f instanceof ErrorEvent?v=f.error:v="There was an error with the transport",this._logger.log(a.Information,`(WebSockets transport) ${v}.`)},s.onmessage=f=>{if(this._logger.log(a.Trace,`(WebSockets transport) data received. ${ue(f.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(f.data)}catch(v){this._close(v);return}},s.onclose=f=>{if(p)this._close(f);else{let v=null;typeof ErrorEvent<"u"&&f instanceof ErrorEvent?v=f.error:v="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",o(new Error(v))}}})})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(a.Trace,`(WebSockets transport) sending data. ${ue(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(a.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}};var Sn=100,Et=class{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,I.isRequired(e,"url"),this._logger=Cn(t.logger),this.baseUrl=this._resolveUrl(e),t=t||{},t.logMessageContent=t.logMessageContent===void 0?!1:t.logMessageContent,typeof t.withCredentials=="boolean"||t.withCredentials===void 0)t.withCredentials=t.withCredentials===void 0?!0:t.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.timeout=t.timeout===void 0?100*1e3:t.timeout;let n=null,i=null;if(P.isNode&&typeof Se<"u"){let o=typeof __webpack_require__=="function"?__non_webpack_require__:Se;n=o("ws"),i=o("eventsource")}!P.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:P.isNode&&!t.WebSocket&&n&&(t.WebSocket=n),!P.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:P.isNode&&!t.EventSource&&typeof i<"u"&&(t.EventSource=i),this._httpClient=new yt(t.httpClient||new Ct(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}start(e){return b(this,null,function*(){if(e=e||O.Binary,I.isIn(e,O,"transferFormat"),this._logger.log(a.Debug,`Starting connection with transfer format '${O[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),yield this._startInternalPromise,this._connectionState==="Disconnecting"){let t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(a.Error,t),yield this._stopPromise,Promise.reject(new B(t))}else if(this._connectionState!=="Connected"){let t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(a.Error,t),Promise.reject(new B(t))}this._connectionStarted=!0})}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Lt(this.transport)),this._sendQueue.send(e))}stop(e){return b(this,null,function*(){if(this._connectionState==="Disconnected")return this._logger.log(a.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(a.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),yield this._stopInternal(e),yield this._stopPromise})}_stopInternal(e){return b(this,null,function*(){this._stopError=e;try{yield this._startInternalPromise}catch{}if(this.transport){try{yield this.transport.stop()}catch(t){this._logger.log(a.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(a.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")})}_startInternal(e){return b(this,null,function*(){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===D.WebSockets)this.transport=this._constructTransport(D.WebSockets),yield this._startTransport(t,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let n=null,i=0;do{if(n=yield this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new B("The connection was stopped during negotiation.");if(n.error)throw new Error(n.error);if(n.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(n.url&&(t=n.url),n.accessToken){let o=n.accessToken;this._accessTokenFactory=()=>o,this._httpClient._accessToken=o,this._httpClient._accessTokenFactory=void 0}i++}while(n.url&&i<Sn);if(i===Sn&&n.url)throw new Error("Negotiate redirection limit exceeded.");yield this._createTransport(t,this._options.transport,n,e)}this.transport instanceof Ge&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(a.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(n){return this._logger.log(a.Error,"Failed to start the connection: "+n),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(n)}})}_getNegotiationResponse(e){return b(this,null,function*(){let t={},[n,i]=re();t[n]=i;let o=this._resolveNegotiateUrl(e);this._logger.log(a.Debug,`Sending negotiation request: ${o}.`);try{let s=yield this._httpClient.post(o,{content:"",headers:y(y({},t),this._options.headers),timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(s.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${s.statusCode}'`));let l=JSON.parse(s.content);return(!l.negotiateVersion||l.negotiateVersion<1)&&(l.connectionToken=l.connectionId),l.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new qe("Client didn't negotiate Stateful Reconnect but the server did.")):l}catch(s){let l="Failed to complete negotiation with the server: "+s;return s instanceof W&&s.statusCode===404&&(l=l+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(a.Error,l),Promise.reject(new qe(l))}})}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}_createTransport(e,t,n,i){return b(this,null,function*(){let o=this._createConnectUrl(e,n.connectionToken);if(this._isITransport(t)){this._logger.log(a.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,yield this._startTransport(o,i),this.connectionId=n.connectionId;return}let s=[],l=n.availableTransports||[],p=n;for(let f of l){let v=this._resolveTransportOrError(f,t,i,p?.useStatefulReconnect===!0);if(v instanceof Error)s.push(`${f.transport} failed:`),s.push(v);else if(this._isITransport(v)){if(this.transport=v,!p){try{p=yield this._getNegotiationResponse(e)}catch(N){return Promise.reject(N)}o=this._createConnectUrl(e,p.connectionToken)}try{yield this._startTransport(o,i),this.connectionId=p.connectionId;return}catch(N){if(this._logger.log(a.Error,`Failed to start the transport '${f.transport}': ${N}`),p=void 0,s.push(new dt(`${f.transport} failed: ${N}`,D[f.transport])),this._connectionState!=="Connecting"){let ve="Failed to select transport before stop() was called.";return this._logger.log(a.Debug,ve),Promise.reject(new B(ve))}}}}return s.length>0?Promise.reject(new ht(`Unable to connect to the server with any of the available transports. ${s.join(" ")}`,s)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))})}_constructTransport(e){switch(e){case D.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new xt(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case D.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Pt(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case D.LongPolling:return new Ge(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=n=>b(this,null,function*(){let i=!1;if(this.features.reconnect)try{this.features.disconnected(),yield this.transport.connect(e,t),yield this.features.resend()}catch{i=!0}else{this._stopConnection(n);return}i&&this._stopConnection(n)}):this.transport.onclose=n=>this._stopConnection(n),this.transport.connect(e,t)}_resolveTransportOrError(e,t,n,i){let o=D[e.transport];if(o==null)return this._logger.log(a.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(Xn(t,o))if(e.transferFormats.map(l=>O[l]).indexOf(n)>=0){if(o===D.WebSockets&&!this._options.WebSocket||o===D.ServerSentEvents&&!this._options.EventSource)return this._logger.log(a.Debug,`Skipping transport '${D[o]}' because it is not supported in your environment.'`),new mt(`'${D[o]}' is not supported in your environment.`,o);this._logger.log(a.Debug,`Selecting transport '${D[o]}'.`);try{return this.features.reconnect=o===D.WebSockets?i:void 0,this._constructTransport(o)}catch(l){return l}}else return this._logger.log(a.Debug,`Skipping transport '${D[o]}' because it does not support the requested transfer format '${O[n]}'.`),new Error(`'${D[o]}' does not support ${O[n]}.`);else return this._logger.log(a.Debug,`Skipping transport '${D[o]}' because it was disabled by the client.`),new pt(`'${D[o]}' is disabled by the client.`,o)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(a.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(a.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(a.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(a.Error,`Connection disconnected with error '${e}'.`):this._logger.log(a.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(a.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(a.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!P.isBrowser)throw new Error(`Cannot resolve '${e}'.`);let t=window.document.createElement("a");return t.href=e,this._logger.log(a.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){let t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";let n=new URLSearchParams(t.searchParams);return n.has("negotiateVersion")||n.append("negotiateVersion",this._negotiateVersion.toString()),n.has("useStatefulReconnect")?n.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&n.append("useStatefulReconnect","true"),t.search=n.toString(),t.toString()}};function Xn(r,e){return!r||(e&r)!==0}var Lt=class r{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new Le,this._transportResult=new Le,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new Le),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}_sendLoop(){return b(this,null,function*(){for(;;){if(yield this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new Le;let e=this._transportResult;this._transportResult=void 0;let t=typeof this._buffer[0]=="string"?this._buffer.join(""):r._concatBuffers(this._buffer);this._buffer.length=0;try{yield this._transport.send(t),e.resolve()}catch(n){e.reject(n)}}})}static _concatBuffers(e){let t=e.map(o=>o.byteLength).reduce((o,s)=>o+s),n=new Uint8Array(t),i=0;for(let o of e)n.set(new Uint8Array(o),i),i+=o.byteLength;return n.buffer}},Le=class{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}};var ei="json",Ot=class{constructor(){this.name=ei,this.version=2,this.transferFormat=O.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=ie.instance);let n=Q.parse(e),i=[];for(let o of n){let s=JSON.parse(o);if(typeof s.type!="number")throw new Error("Invalid payload.");switch(s.type){case u.Invocation:this._isInvocationMessage(s);break;case u.StreamItem:this._isStreamItemMessage(s);break;case u.Completion:this._isCompletionMessage(s);break;case u.Ping:break;case u.Close:break;case u.Ack:this._isAckMessage(s);break;case u.Sequence:this._isSequenceMessage(s);break;default:t.log(a.Information,"Unknown message type '"+s.type+"' ignored.");continue}i.push(s)}return i}writeMessage(e){return Q.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}};var ti={trace:a.Trace,debug:a.Debug,info:a.Information,information:a.Information,warn:a.Warning,warning:a.Warning,error:a.Error,critical:a.Critical,none:a.None};function ni(r){let e=ti[r.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${r}`)}var We=class{configureLogging(e){if(I.isRequired(e,"logging"),ii(e))this.logger=e;else if(typeof e=="string"){let t=ni(e);this.logger=new be(t)}else this.logger=new be(e);return this}withUrl(e,t){return I.isRequired(e,"url"),I.isNotEmpty(e,"url"),this.url=e,typeof t=="object"?this.httpConnectionOptions=y(y({},this.httpConnectionOptions),t):this.httpConnectionOptions=le(y({},this.httpConnectionOptions),{transport:t}),this}withHubProtocol(e){return I.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new Ve(e):this.reconnectPolicy=e:this.reconnectPolicy=new Ve,this}withServerTimeout(e){return I.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return I.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e?.bufferSize,this}build(){let e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");let t=new Et(this.url,e);return Mt.create(t,this.logger||ie.instance,this.protocol||new Ot,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}};function ii(r){return r.log!==void 0}var si=["chat"];function ai(r,e){if(r&1){let t=j();c(0,"app-meeple-room-menu",17),S("fetchData",function(){T(t);let i=C(2);return R(i.onLeaveCompleted())}),m()}if(r&2){let t=C(2);_("room",t.room)("isCurrentUserParticipateInRoom",t.isCurrentUserParticipateInRoom)}}function ci(r,e){if(r&1){let t=j();L(0),c(1,"div",12)(2,"span",13),S("click",function(){T(t);let i=C();return R(i.backNavigateBtn())}),m(),c(3,"span",14),g(4,"Lobby"),m(),M(5,ai,1,2,"app-meeple-room-menu",15),m(),c(6,"div",16),g(7),m(),$()}if(r&2){let t=C();d(5),_("ngIf",t.room),d(2),z(t.room.name)}}function li(r,e){if(r&1&&(L(0),c(1,"span",23),g(2),m(),$()),r&2){let t=C(3).$implicit;d(2),z(t.senderUsername)}}function mi(r,e){if(r&1&&(L(0),M(1,li,3,1,"ng-container",3),c(2,"div",22)(3,"span"),g(4),m()(),$()),r&2){let t=e.$implicit,n=C(2),i=n.$implicit,o=n.index,s=C();d(),_("ngIf",i.senderUsername!==s.getPreviousSenderUsername(o)),d(3),z(t.text)}}function pi(r,e){if(r&1&&(c(0,"div",21),M(1,mi,5,2,"ng-container",6),m()),r&2){let t=C().$implicit;d(),_("ngForOf",t.messages)}}function di(r,e){if(r&1&&(L(0),c(1,"span",23),g(2),m(),$()),r&2){let t=C(3).$implicit;d(2),z(t.senderUsername)}}function hi(r,e){if(r&1&&(L(0),M(1,di,3,1,"ng-container",3),c(2,"div",22)(3,"span"),g(4),m()(),$()),r&2){let t=e.$implicit,n=C(2),i=n.$implicit,o=n.index,s=C();d(),_("ngIf",i.senderUsername!==s.getPreviousSenderUsername(o)),d(3),z(t.text)}}function gi(r,e){if(r&1&&(c(0,"div",24),M(1,hi,5,2,"ng-container",6),m()),r&2){let t=C().$implicit;d(),_("ngForOf",t.messages)}}function _i(r,e){if(r&1&&(L(0),c(1,"span",25),g(2),m(),$()),r&2){let t=e.$implicit;d(2),z(t.text)}}function fi(r,e){if(r&1&&(L(0),M(1,pi,2,1,"div",18)(2,gi,2,1,"div",19),c(3,"div",20),M(4,_i,3,1,"ng-container",6),m(),$()),r&2){let t=e.$implicit,n=C();d(),_("ngIf",t.senderId!==n.getActiveUserIdFromChat()),d(),_("ngIf",t.senderId===n.getActiveUserIdFromChat()),d(2),_("ngForOf",t.infoMessages)}}var Mn=(()=>{let e=class e{constructor(n,i,o,s,l,p,f){this.roomService=n,this.menuTabsService=i,this.authService=o,this.cdRef=s,this.router=l,this.activeRoute=p,this.toastService=f,this.roomInfoMessages=[],this.roomMessages=[],this.isCurrentUserParticipateInRoom=!1,this.shouldScrollToBottom=!1,this.currentChatMessagesSubject$=new Qe([]),this.menuTabsService.setActive(ee.MEEPLE)}ngAfterViewChecked(){this.shouldScrollToBottom&&(this.scrollToBottom(),this.shouldScrollToBottom=!1)}ngOnInit(){this.activeRoute.params.subscribe(n=>{this.roomId=+n.id,this.fetchData(),this.startConnection()})}ngOnDestroy(){this.menuTabsService.resetData(),this.hubConnection.stop()}addMessage(){this.message&&this.hubConnection.invoke(Ne.CHAT_HUB_CLIENT.SEND_MESSAGE_TO_GROUP,this.roomId,this.message).then(()=>this.message="").catch(n=>console.error(n))}getActiveUserIdFromChat(){return this.authService.getUser?this.authService.getUser.id:""}backNavigateBtn(){this.router.navigateByUrl(G.MEEPLE_ROOM.DETAILS_BY_ID(this.roomId))}onLeaveCompleted(){this.backNavigateBtn()}fetchData(){oe([this.roomService.getById(this.roomId),this.roomService.getMessageList(this.roomId),this.roomService.getInfoMessageList(this.roomId),this.roomService.checkUserParticipateInRoom(this.roomId)]).subscribe({next:([n,i,o,s])=>{n&&i&&(this.room=n,this.roomMessages=i,this.roomInfoMessages=o.map(l=>le(y({},l),{createdDate:new Date(l.createdDate)})),this.isCurrentUserParticipateInRoom=n.createdBy===this.authService.getUser?.id||s,this.updateRoomMessages(),this.menu&&(this.menu.room=this.room,this.menu.isCurrentUserParticipateInRoom=this.isCurrentUserParticipateInRoom,this.menu.updateMenuItems()))},error:n=>{this.toastService.error({message:F.SomethingWrong,type:U.Error}),$e(()=>n)}})}scrollToBottom(){this.chatContainer.nativeElement.scrollTo({top:this.chatContainer.nativeElement.scrollHeight,behavior:"smooth"})}startConnection(){let n=localStorage.getItem("jwt");this.hubConnection=new We().withUrl(`${tn.defaultAppUrl}/${Ne.CHAT_HUB_CLIENT.CORE}`,{accessTokenFactory:()=>n}).build(),this.hubConnection.start().then(()=>{this.hubConnection.invoke(Ne.CHAT_HUB_CLIENT.CONNECT_TO_GROUP,this.roomId).catch(i=>console.error(i)),this.hubConnection.on(Ne.CHAT_HUB_CLIENT.RECEIVE_MESSAGE,(i,o,s,l)=>{let p=this.currentChatMessagesSubject$.value,f={senderId:i,senderUsername:o,messages:[{createdDate:l,text:s}],createdDate:l,infoMessages:[]};p.push(f);let v=p.sort((N,ve)=>new Date(N.createdDate).valueOf()-new Date(ve.createdDate).valueOf());this.currentChatMessagesSubject$.next(v),this.shouldScrollToBottom=!0,this.cdRef.detectChanges()})}).catch(i=>console.log("Error while starting connection: "+i))}getPreviousSenderUsername(n){let i=this.currentChatMessagesSubject$.value;return i[n-1]?i[n-1].senderUsername:""}updateRoomMessages(){let n=this.createGroupsFromRoomMessages(),i=this.processGroupInfoMessages(n);n.length===0&&(i=this.roomInfoMessages.map(s=>({senderId:"",senderUsername:"",messages:[],createdDate:s.createdDate,infoMessages:[{text:s.message,createdDate:s.createdDate}]})));let o=n.concat(i).sort((s,l)=>new Date(s.createdDate).valueOf()-new Date(l.createdDate).valueOf());this.currentChatMessagesSubject$.next(o),this.shouldScrollToBottom=!0,this.cdRef.detectChanges()}createGroupsFromRoomMessages(){let n=[];for(let i of this.roomMessages){let o={senderId:i.senderId,senderUsername:i.senderUsername,messages:[{createdDate:i.createdDate,text:i.message}],createdDate:i.createdDate,infoMessages:[]};n.push(o)}return n}processGroupInfoMessages(n){let i=[];for(let o=0;o<n.length;o++){let s=n[o],l=n[o+1],p=this.getSmallestDateCreated(s),f=l?this.getSmallestDateCreated(l):Number.MAX_SAFE_INTEGER,v=this.getFilteredInfoMessagesBefore(p),N=this.getFilteredInfoMessagesInMiddle(p,f),ve=this.getFilteredInfoMessagesAfter(f);this.addInfoMessagesToGroup(s,N),this.addFilteredInfoMessagesToNewGroups(v,i),this.addFilteredInfoMessagesToNewGroups(ve,i),this.removeProcessedInfoMessages(v,N,ve)}return i}getSmallestDateCreated(n){return Math.min(...n.messages.map(i=>new Date(i.createdDate).valueOf()))}getFilteredInfoMessagesBefore(n){return this.roomInfoMessages.filter(i=>i.createdDate<=new Date(n))}getFilteredInfoMessagesInMiddle(n,i){return this.roomInfoMessages.filter(o=>o.createdDate>=new Date(n)&&o.createdDate<=new Date(i))}getFilteredInfoMessagesAfter(n){return this.roomInfoMessages.filter(i=>i.createdDate>=new Date(n))}addInfoMessagesToGroup(n,i){for(let o of i)n.infoMessages.push({createdDate:o.createdDate,text:o.message})}addFilteredInfoMessagesToNewGroups(n,i){for(let o of n)i.push({senderId:"",senderUsername:"",messages:[],createdDate:o.createdDate,infoMessages:[{text:o.message,createdDate:o.createdDate}]})}removeProcessedInfoMessages(...n){let i=n.flat();this.roomInfoMessages=this.roomInfoMessages.filter(o=>!i.includes(o))}};e.\u0275fac=function(i){return new(i||e)(h(H),h(te),h(he),h(Vt),h(K),h(de),h(X))},e.\u0275cmp=A({type:e,selectors:[["app-room-chat"]],viewQuery:function(i,o){if(i&1&&(Ue(si,5),Ue(_e,5)),i&2){let s;Be(s=je())&&(o.chatContainer=s.first),Be(s=je())&&(o.menu=s.first)}},decls:14,vars:5,consts:[["chat",""],[1,"wrapper_container"],[1,"wrapper_header_container"],[4,"ngIf"],[1,"wrapper_lobby"],[1,"wrapper_lobby__chat"],[4,"ngFor","ngForOf"],[1,"form__group"],["type","text","placeholder","search","name","search","id","search",1,"form__field",3,"ngModelChange","ngModel"],["for","search",1,"form__label"],["height","24px","viewBox","0 -960 960 960","width","24px","fill","#fafafa",3,"click"],["d","m317.23-83.69-59.54-59.54L595.46-481 257.69-818.77l59.54-59.54L714.54-481 317.23-83.69Z"],[1,"wrapper_icons"],[1,"arrow","left",3,"click"],[1,"header"],[3,"room","isCurrentUserParticipateInRoom","fetchData",4,"ngIf"],[1,"wrapper_header"],[3,"fetchData","room","isCurrentUserParticipateInRoom"],["class","wrapper_lobby__left-chat",4,"ngIf"],["class","wrapper_lobby__right-chat",4,"ngIf"],[1,"wrapper_lobby__info-messages"],[1,"wrapper_lobby__left-chat"],[1,"item"],[1,"username"],[1,"wrapper_lobby__right-chat"],[1,"info-message"]],template:function(i,o){if(i&1){let s=j();c(0,"div",1)(1,"div",2),M(2,ci,8,2,"ng-container",3),m(),c(3,"div",4,0)(5,"div",5),M(6,fi,5,3,"ng-container",6),q(7,"async"),m()(),c(8,"div",7)(9,"input",8),Xe("ngModelChange",function(p){return T(s),Ke(o.message,p)||(o.message=p),R(p)}),m(),c(10,"label",9),g(11," Write your message here"),m(),k(),c(12,"svg",10),S("click",function(){return T(s),R(o.addMessage())}),w(13,"path",11),m()()()}i&2&&(d(2),_("ngIf",o.room),d(4),_("ngForOf",Ce(7,3,o.currentChatMessagesSubject$.asObservable())),d(3),Je("ngModel",o.message))},dependencies:[ye,Z,et,tt,nt,_e,Ie],styles:['.wrapper_container[_ngcontent-%COMP%]{overflow:auto;display:flex;flex-direction:column;justify-content:space-between;height:85dvh}.wrapper_container[_ngcontent-%COMP%]   .wrapper_header_container[_ngcontent-%COMP%]   .wrapper_header[_ngcontent-%COMP%]{text-align:center;font-size:1.5rem;max-width:100%;margin:1rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_header_container[_ngcontent-%COMP%]   .wrapper_icons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:1rem 1rem 0;align-items:center}.wrapper_container[_ngcontent-%COMP%]   .wrapper_header_container[_ngcontent-%COMP%]   .wrapper_icons[_ngcontent-%COMP%]   .exit[_ngcontent-%COMP%]{width:3rem;height:3rem;color:#bf3c65;font-size:3rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_header_container[_ngcontent-%COMP%]   .wrapper_icons[_ngcontent-%COMP%]   .header_name[_ngcontent-%COMP%]{font-size:1.5rem;padding-top:1rem;padding-bottom:.5rem;word-wrap:break-word;width:70%;text-align:center}.wrapper_container[_ngcontent-%COMP%]   .wrapper_header_container[_ngcontent-%COMP%]   .wrapper_icons[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{width:3rem;height:3rem;display:inline-block;position:relative;border:.1rem solid #98989d;border-radius:2.5rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_header_container[_ngcontent-%COMP%]   .wrapper_icons[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]:before{content:"";display:block;width:.75rem;height:.75rem;top:65%;left:63%;border-style:solid;border-color:#98989d;border-width:.2rem .2rem 0 0;position:absolute;transform-origin:50% 50%}.wrapper_container[_ngcontent-%COMP%]   .wrapper_header_container[_ngcontent-%COMP%]   .wrapper_icons[_ngcontent-%COMP%]   .arrow.left[_ngcontent-%COMP%]:before{transform:rotate(-135deg);margin:-.9rem 0 0 -.6rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_header_container[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:center;font-size:1.25rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby[_ngcontent-%COMP%]{text-align:center;margin:1rem;overflow:auto;width:90%}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__left-chat[_ngcontent-%COMP%]{margin-top:1rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__left-chat[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-size:.8rem;color:gray;display:flex;justify-content:start;margin-bottom:.75rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__left-chat[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;align-items:start}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__left-chat[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{border-radius:.5rem;padding:.5rem .4rem;display:inline;background-color:#31313b;max-width:70%;text-align:start;word-wrap:break-word}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__left-chat[_ngcontent-%COMP%]   .item__image[_ngcontent-%COMP%]{text-align:center;margin:.2rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__left-chat[_ngcontent-%COMP%]   .item__image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem;object-fit:cover;border-radius:5rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__right-chat[_ngcontent-%COMP%]{margin-top:1rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__right-chat[_ngcontent-%COMP%]   .username[_ngcontent-%COMP%]{font-size:.8rem;color:gray;display:flex;justify-content:end;margin-bottom:.75rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__right-chat[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:flex;justify-content:end}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__right-chat[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{border-radius:.5rem;padding:.5rem .4rem;display:inline;background-color:#31313b;max-width:70%;text-align:end;word-wrap:break-word;direction:rtl}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__right-chat[_ngcontent-%COMP%]   .item__image[_ngcontent-%COMP%]{text-align:center;margin:.2rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__right-chat[_ngcontent-%COMP%]   .item__image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem;object-fit:cover;border-radius:5rem}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__info-messages[_ngcontent-%COMP%]{display:flex;flex-direction:column}.wrapper_container[_ngcontent-%COMP%]   .wrapper_lobby__info-messages[_ngcontent-%COMP%]   .info-message[_ngcontent-%COMP%]{font-size:1rem;color:gray;margin:1rem}.wrapper_container[_ngcontent-%COMP%]   .form__group[_ngcontent-%COMP%]{position:relative;display:flex;margin:0 auto;width:90%;padding:10px 0 0;align-items:center}.wrapper_container[_ngcontent-%COMP%]   .form__group[_ngcontent-%COMP%]   .form__field[_ngcontent-%COMP%]{background-color:#31313b;width:100%;border:0;outline:0;font-size:small;color:#fff;padding:.7rem 1rem;border-radius:3rem;transition:border-color .2s}.wrapper_container[_ngcontent-%COMP%]   .form__group[_ngcontent-%COMP%]   .form__field[_ngcontent-%COMP%]::placeholder{color:transparent}.wrapper_container[_ngcontent-%COMP%]   .form__group[_ngcontent-%COMP%]   .form__field[_ngcontent-%COMP%]:placeholder-shown ~ .form__label[_ngcontent-%COMP%]{font-size:1rem;cursor:text;top:20px}.wrapper_container[_ngcontent-%COMP%]   .form__group[_ngcontent-%COMP%]   .form__label[_ngcontent-%COMP%]{position:absolute;top:0;display:block;transition:.2s;font-size:1rem;color:#9b9b9b;padding-left:1rem}.wrapper_container[_ngcontent-%COMP%]   .form__group[_ngcontent-%COMP%]   .form__field[_ngcontent-%COMP%]:focus{padding-bottom:.6rem;font-weight:700;border-width:3px}.wrapper_container[_ngcontent-%COMP%]   .form__group[_ngcontent-%COMP%]   .form__field[_ngcontent-%COMP%]:focus ~ .form__label[_ngcontent-%COMP%]{position:absolute;top:0;display:block;transition:.2s;font-size:.8rem;color:#9b9b9b;font-weight:700}']});let r=e;return r})();var yn=(()=>{let e=class e{constructor(n,i,o,s){this.data=n,this.dialogRef=i,this.roomService=o,this.toastService=s}onRemove(){this.roomService.removeMember(this.data.roomId,this.data.userId).subscribe({next:()=>{this.toastService.success({message:"Member removed successfully",type:U.Success}),this.dialogRef.close(!0)},error:()=>{this.toastService.error({message:F.SomethingWrong,type:U.Error}),this.dialogRef.close(!1)}})}};e.\u0275fac=function(i){return new(i||e)(h(Te),h(Oe),h(H),h(X))},e.\u0275cmp=A({type:e,selectors:[["app-room-member-confirm-delete-dialog"]],decls:8,vars:0,consts:[[1,"dialog-container"],[1,"dialog-container__header","m-4"],["mat-dialog-close","",1,"btn","btn__small","btn-blue"],[1,"btn","btn__small","btn-red","btn-border-red",3,"click"]],template:function(i,o){i&1&&(c(0,"div",0)(1,"h3",1),g(2,"Remove Member?"),m(),c(3,"mat-dialog-actions")(4,"button",2),g(5,"Cancel"),m(),c(6,"button",3),S("click",function(){return o.onRemove()}),g(7," Remove "),m()()())},dependencies:[ke,Re],styles:[".dialog-container[_ngcontent-%COMP%]{color:#fff;background-color:#31313b}.dialog-container__header[_ngcontent-%COMP%]{margin:1rem}.dialog-container[_ngcontent-%COMP%]   mat-dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:end}.dialog-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:.4rem}"]});let r=e;return r})();function ui(r,e){if(r&1){let t=j();c(0,"div",12),k(),c(1,"svg",13),S("click",function(){T(t);let i=C(2).$implicit,o=C();return R(o.onDelete(i.userId))}),w(2,"path",14),m()()}}function vi(r,e){if(r&1&&(L(0),M(1,ui,3,0,"div",11),$()),r&2){let t=C().$implicit,n=C();d(),_("ngIf",n.room.createdBy!==t.userId)}}function Ci(r,e){r&1&&(c(0,"span",15),g(1,"Owner - "),m())}function bi(r,e){if(r&1&&(c(0,"li")(1,"div",5),M(2,vi,2,1,"ng-container",6),c(3,"div",7)(4,"span",8),M(5,Ci,2,0,"span",9),g(6),c(7,"span",10),g(8),m()(),w(9,"br"),c(10,"small"),g(11),q(12,"date"),m()()()()),r&2){let t=e.$implicit,n=C();d(2),_("ngIf",n.room.createdBy===n.getCurrentUserId()),d(3),_("ngIf",n.room.createdBy===t.userId),d(),V("",t.username," - "),d(2),V(" age ",t.age,""),d(3),V("Joined at ",ae(12,5,t.joinedAt,"MMMM d, yyyy"),"")}}var In=(()=>{let e=class e{constructor(n,i,o,s,l,p,f){this.menuTabsService=n,this.searchService=i,this.roomService=o,this.activeRoute=s,this.authService=l,this.location=p,this.dialog=f,this.members=[],this.menuTabsService.setActive(ee.MEEPLE)}ngOnInit(){this.activeRoute.params.subscribe(n=>{this.roomId=+n.id,this.fetchMembers()})}ngOnDestroy(){this.menuTabsService.resetData(),this.searchService.hideSearchForm()}getCurrentUserId(){return this.authService.getUser?this.authService.getUser.id:""}handleSearchExpression(n){this.fetchMembers(n)}onBack(){this.location.back()}onDelete(n){this.dialog.open(yn,{data:{roomId:this.roomId,userId:n}}).afterClosed().subscribe(o=>{o&&this.fetchMembers()})}fetchMembers(n=""){oe([this.roomService.getById(this.roomId),this.roomService.getMembers(this.roomId,n)]).subscribe({next:([i,o])=>{o&&(this.members=o),i&&(this.room=i)}})}};e.\u0275fac=function(i){return new(i||e)(h(te),h(rt),h(H),h(de),h(he),h(Gt),h(it))},e.\u0275cmp=A({type:e,selectors:[["app-room-members"]],decls:5,vars:4,consts:[["header","Room Members",3,"searchExpressionResult","backClicked","withSearch","withBackBtn","withBottomLine"],[1,"wrapper"],[1,"guestlist"],[1,"attendes"],[4,"ngFor","ngForOf"],[1,"item"],[4,"ngIf"],[1,"user-info"],[1,"name"],["class","owner",4,"ngIf"],[1,"age"],["class","user-actions",4,"ngIf"],[1,"user-actions"],["viewBox","0 -960 960 960",1,"remove",3,"click"],["d","M252-203.69 205.69-252l227-228-227-230L252-758.31l229 230 227-230L754.31-710l-227 230 227 228L708-203.69l-227-230-229 230Z"],[1,"owner"]],template:function(i,o){i&1&&(c(0,"app-header",0),S("searchExpressionResult",function(l){return o.handleSearchExpression(l)})("backClicked",function(){return o.onBack()}),m(),c(1,"div",1)(2,"div",2)(3,"ul",3),M(4,bi,13,8,"li",4),m()()()),i&2&&(_("withSearch",!0)("withBackBtn",!0)("withBottomLine",!0),d(4),_("ngForOf",o.members))},dependencies:[ye,Z,ot,me],styles:[".guestlist[_ngcontent-%COMP%]{overflow:hidden;position:relative;padding:0 1rem}.guestlist[_ngcontent-%COMP%]   .attendes[_ngcontent-%COMP%]{list-style:none;margin:0;padding:0;margin-bottom:1rem;overflow-y:auto}.guestlist[_ngcontent-%COMP%]   .attendes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{float:none;width:100%}.guestlist[_ngcontent-%COMP%]   .attendes[_ngcontent-%COMP%]   li.last[_ngcontent-%COMP%]{border-bottom:none}.guestlist[_ngcontent-%COMP%]   .attendes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{display:block;margin:0 1rem;padding:1rem 0;border-bottom:1px solid #ccc}.guestlist[_ngcontent-%COMP%]   .attendes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{float:left;margin-right:10px}.guestlist[_ngcontent-%COMP%]   .attendes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]{display:block;margin-top:5px}.guestlist[_ngcontent-%COMP%]   .attendes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .owner[_ngcontent-%COMP%]{color:#75a0ff}.guestlist[_ngcontent-%COMP%]   .attendes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .user-info[_ngcontent-%COMP%]   .age[_ngcontent-%COMP%]{color:#999;font-weight:400}.guestlist[_ngcontent-%COMP%]   .attendes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]{margin-top:.75rem;float:right}.guestlist[_ngcontent-%COMP%]   .attendes[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .remove[_ngcontent-%COMP%]{fill:#bf3c65;width:1.5rem;height:1.5rem}"]});let r=e;return r})();function wi(r,e){r&1&&(c(0,"div",41)(1,"p"),g(2,"The room will be available until the selected date."),m()())}function Si(r,e){r&1&&(k(),c(0,"svg",42),w(1,"path",43),m())}function Mi(r,e){r&1&&(k(),c(0,"svg",44),w(1,"path",45),m())}function yi(r,e){if(r&1&&(c(0,"span"),g(1),m()),r&2){let t=C();d(),Ye(" ",t.gameInventory.availableCopies," / ",t.gameInventory.totalCopies," ")}}function Ii(r,e){if(r&1&&(c(0,"div",46),g(1),m()),r&2){let t=C();d(),V(" ",t.getFirstErrorMessage()," ")}}var $t=(()=>{let e=class e extends an{constructor(n,i,o,s,l,p,f,v,N){super(n),this.toastService=n,this.gameService=i,this.roomService=o,this.menuTabsService=s,this.fb=l,this.entityImagePipe=p,this.router=f,this.activatedRoute=v,this.datePipe=N,this.gameList=[],this.selectedGame=null,this.game=null,this.imagePreview=null,this.isMenuVisible=!1,this.editRoomId=null,this.form=this.initFormGroup(),this.form.valueChanges.subscribe(()=>{this.getServerErrorMessage&&this.clearServerErrorMessage()}),this.menuTabsService.setActive(ee.MEEPLE)}getGame(n){return!this.game||this.game[n]===void 0?"":this.game[n].toString()}ngOnDestroy(){this.menuTabsService.resetData()}ngOnInit(){let n=this.activatedRoute.snapshot.paramMap.get("id");n?(this.editRoomId=+n,this.fetchRoom(this.editRoomId)):this.fetchGameList()}handleSelectGame(){this.selectedGame?.id&&this.fetchGameById(this.selectedGame.id)}showMenu(){this.isMenuVisible=!this.isMenuVisible}backNavigateBtn(){this.editRoomId?this.router.navigateByUrl(`meeples/${this.editRoomId}/details`):this.router.navigateByUrl("meeples/find")}onSubmit(){let n=this.form.controls.startDate.value,i=this.form.controls.startTime.value;if(this.form.valid&&n&&i){let o=ce.combineDateAndTime(n,i);this.editRoomId?this.roomService.update({id:this.editRoomId,gameId:parseInt(this.form.controls.gameId.value),name:this.form.controls.name.value,startDate:o,maxParticipants:this.form.controls.maxParticipants.value}).subscribe({next:s=>{this.toastService.success({message:F.ChangesSaved,type:U.Success}),this.router.navigateByUrl(`/meeples/${this.editRoomId}/details`)},error:s=>{this.handleServerErrors(s),this.toastService.error({message:F.FailedToSaveChanges,type:U.Error})}}):this.roomService.add({gameId:parseInt(this.form.controls.gameId.value),name:this.form.controls.name.value,startDate:o,maxParticipants:this.form.controls.maxParticipants.value}).subscribe({next:s=>{this.toastService.success({message:F.ChangesSaved,type:U.Success}),this.router.navigateByUrl("/meeples/find")},error:s=>{this.handleServerErrors(s),this.toastService.error({message:F.FailedToSaveChanges,type:U.Error})}})}}fetchRoom(n){oe([this.gameService.getDropdownList(),this.roomService.getById(n)]).subscribe({next:([i,o])=>{console.log(o),this.gameList=i;let s=this.datePipe.transform(o.startDate,ce.DATE_FORMAT_FOR_INPUT),l=this.datePipe.transform(o.startDate,ce.TIME_FORMAT);this.form.patchValue({gameId:parseInt(o.gameId),name:o.name,startDate:s?.toString(),startTime:l?.toString(),maxParticipants:o.maxParticipants}),console.log("gameId",parseInt(o.gameId));let p=this.gameList.find(f=>f.id==o.gameId);console.log("select game ",p),p&&(this.selectedGame=p,this.handleSelectGame())}})}fetchGameList(){this.gameService.getDropdownList().subscribe({next:n=>{if(this.gameList=n??[],this.selectedGame){let i=this.gameList.find(o=>o.id==this.selectedGame?.id);i&&(this.selectedGame=i)}},error:n=>{this.toastService.error({message:F.SomethingWrong,type:U.Error}),$e(()=>n)}})}fetchGameById(n){oe([this.gameService.getById(n),this.gameService.getInventory(n)]).subscribe({next:([i,o])=>{i&&o&&(this.game=i,this.form.patchValue({gameId:i.id}),this.entityImagePipe.transform(xe.Games,i.imageId).subscribe(s=>this.imagePreview=s),this.gameInventory=o)},error:i=>{this.toastService.error({message:F.SomethingWrong,type:U.Error}),$e(()=>i)}})}getControlDisplayName(n){switch(n){case"name":return"Name";case"startDate":return"Start date";case"startTime":return"Start time";case"maxParticipants":return"Max participants";case"gameId":return"Game";default:return n}}initFormGroup(){return this.fb.group({gameId:new Pe(null,[pe.required]),name:new Pe("",[pe.required,pe.minLength(3)]),startDate:new Pe(null,[pe.required]),startTime:new Pe(null,[pe.required]),maxParticipants:new Pe(null,[pe.required,pe.min(1)])})}clearServerErrorMessage(){this.getServerErrorMessage=null}};e.\u0275fac=function(i){return new(i||e)(h(X),h(on),h(H),h(te),h(Kt),h(Ee),h(K),h(de),h(me))},e.\u0275cmp=A({type:e,selectors:[["app-add-update-meeple-room"]],features:[Ht],decls:67,vars:22,consts:[[1,"wrapper_icons"],[1,"arrow","left",3,"click"],[1,"header_name"],[1,"info-container"],["viewBox","0 -960 960 960",1,"info",3,"click"],["d","M448-284h66v-236h-66v236Zm31.82-308.92q14.64 0 24.72-9.9 10.08-9.91 10.08-24.54 0-14.64-9.91-24.72-9.9-10.07-24.53-10.07-14.64 0-24.72 9.9-10.08 9.9-10.08 24.54 0 14.63 9.91 24.71 9.9 10.08 24.53 10.08ZM480.13-88q-81.31 0-152.89-30.86-71.57-30.86-124.52-83.76-52.95-52.9-83.83-124.42Q88-398.55 88-479.87q0-81.56 30.92-153.37 30.92-71.8 83.92-124.91 53-53.12 124.42-83.48Q398.67-872 479.87-872q81.55 0 153.35 30.34 71.79 30.34 124.92 83.42 53.13 53.08 83.49 124.84Q872-561.64 872-480.05q0 81.59-30.34 152.83-30.34 71.23-83.41 124.28-53.07 53.05-124.81 84Q561.7-88 480.13-88Z"],["class","info__text",4,"ngIf"],[1,"select-container"],["bindLabel","name","placeholder","Select Game",1,"app-select",3,"ngModelChange","change","items","ngModel"],[3,"formGroup"],[1,"wrapper_stats"],[1,"wrapper_stats__chips-left"],[1,"chip"],["height","24px","viewBox","0 -960 960 960","width","24px","fill","#fafafa"],["d","m619.85-293.85 46.3-46.3L514-494.33V-684h-66v218.31l171.85 171.84ZM480.13-88q-81.31 0-152.89-30.86-71.57-30.86-124.52-83.76-52.95-52.9-83.83-124.42Q88-398.55 88-479.87q0-81.56 30.92-153.37 30.92-71.8 83.92-124.91 53-53.12 124.42-83.48Q398.67-872 479.87-872q81.55 0 153.35 30.34 71.79 30.34 124.92 83.42 53.13 53.08 83.49 124.84Q872-561.64 872-480.05q0 81.59-30.34 152.83-30.34 71.23-83.41 124.28-53.07 53.05-124.81 84Q561.7-88 480.13-88ZM480-480Zm0 326q136 0 231-95t95-231q0-136-95-231t-231-95q-136 0-231 95t-95 231q0 136 95 231t231 95Z"],["d","M44.85-154.38v-96.85q0-34.85 16.61-59.24t44.57-38.67q56.05-27.78 113.62-44.01 57.58-16.23 136.2-16.23 78.27 0 135.52 16.23 57.25 16.23 113.29 44.01 27.97 14.28 44.58 38.67t16.61 59.24v96.85h-621Zm706 0v-102.7q0-32.77-12.58-73.14-12.57-40.37-42.42-68.47 41.46 6 79.27 18.65 37.8 12.66 72.5 30.96 31.83 16.85 49.68 41.86 17.85 25.01 17.85 50.14v102.7h-164.3Zm-396-357.24q-61.05 0-104.53-43.47-43.47-43.48-43.47-104.53 0-61.05 43.47-104.52 43.48-43.48 104.53-43.48 61.05 0 104.52 43.48 43.48 43.47 43.48 104.52t-43.48 104.53q-43.47 43.47-104.52 43.47Zm375.77-148q0 61.05-43.48 104.53-43.47 43.47-104.52 43.47-6.54 0-19.47-1.57-12.92-1.58-19.46-4.27 22.33-30.9 33.24-67.09 10.92-36.19 10.92-75.16t-11.43-74.59q-11.42-35.62-32.73-67.47 9.23-3.15 19.46-4.5t19.47-1.35q61.05 0 104.52 43.48 43.48 43.47 43.48 104.52ZM110.85-220.38h489v-30.85q0-14.08-5.04-22.62-5.04-8.53-20.27-16.15-45.77-23.92-100.39-38.65-54.61-14.73-118.8-14.73-64.2 0-118.81 14.73-54.62 14.73-100.39 38.65-15.23 7.62-20.27 16.15-5.03 8.54-5.03 22.62v30.85Zm244.12-357.24q33.88 0 57.88-24.12t24-58q0-33.88-24.13-57.88-24.12-24-58-24-33.87 0-57.87 24.13-24 24.12-24 58 0 33.87 24.12 57.87t58 24Zm.88 357.24Zm-1-439.24Z"],[1,"wrapper_image"],[3,"ngClass","src"],[1,"wrapper_stats__chips-right"],["d","M165.23-86q-15.78 0-26.51-10.92Q128-107.83 128-122.77v-189.77q0-38.84 25.88-64.73 25.89-25.88 64.74-25.88H234v-145.16q0-38.84 25.88-64.73 25.89-25.88 64.74-25.88H446v-61.54q-19.23-13.23-29.62-29.04Q406-745.31 406-767.69q0-14.93 4.96-26.58 4.96-11.65 16.89-23.58L480-870l52.15 52.15q11.93 11.93 16.89 23.58 4.96 11.65 4.96 26.58 0 22.38-10.38 38.19-10.39 15.81-29.62 29.04v61.54h121.38q38.85 0 64.74 25.88Q726-587.15 726-548.31v145.16h15.38q38.85 0 64.74 25.88Q832-351.38 832-312.54v189.77q0 14.39-11.19 25.58Q809.62-86 795.23-86h-630ZM300-403.15h360v-145.16q0-10.77-6.92-17.69-6.93-6.92-17.7-6.92H324.62q-10.77 0-17.7 6.92-6.92 6.92-6.92 17.69v145.16ZM194-152h572v-160.54q0-10.77-6.92-17.69-6.93-6.92-17.7-6.92H218.62q-10.77 0-17.7 6.92-6.92 6.92-6.92 17.69V-152Zm106-251.15h360-360ZM194-152h572-572Zm532-251.15H234h492Z"],["class","available","height","24px","viewBox","0 -960 960 960","width","24px",4,"ngIf"],["class","unavailable","height","24px","viewBox","0 -960 960 960","width","24px",4,"ngIf"],[4,"ngIf"],[1,"wrapper_title"],[1,"wrapper_inputs"],[1,"wrapper_inputs__input"],["for","startDate",1,"required"],["formControlName","startDate","type","date","name","startDate"],[1,"wrapper_inputs__time"],["for","startTime",1,"required"],["type","time","name","startTime","formControlName","startTime"],["for","name",1,"required"],["formControlName","name","type","text","name","name"],["for","maxParticipants",1,"required"],["type","number","name","maxParticipants","formControlName","maxParticipants"],[1,"container-errors"],["class","errors",4,"ngIf"],[1,"btn-container"],[1,"wrapper_btn",3,"click"],["viewBox","0 -960 960 960",3,"ngClass"],["d","M253-400q0 57.92 30.27 107.08 30.27 49.15 79.35 74-6.93-6.93-10.77-15.77Q348-243.54 348-252q2-21.54 11.81-41.62 9.81-20.07 26.65-35.92L480-421.85l95.31 92.31q15.84 15.85 25.27 35.92Q610-273.54 612-252q0 8.46-3.85 17.31-3.84 8.84-10.77 15.77 49.08-24.85 79.35-74Q707-342.08 707-400q0-44-16-84.5T646-557q-19.54 11-41.03 16.5-21.5 5.5-43.97 5.5-63.77 0-109.27-36.5-45.5-36.5-59.73-95.04-34 30.23-60 62.73t-43.5 67.27Q271-501.77 262-467.8q-9 33.96-9 67.8Zm227 70-48 47q-10 9-14.5 20.72Q413-250.56 413-238q0 26.67 19.68 45.83Q452.36-173 480-173t47.32-19.09Q547-211.17 547-237.72q0-13.28-5.03-24.63-5.02-11.34-14.23-20.59L480-330Zm-27-459.46V-708q0 45.4 31.27 76.2Q515.53-601 561-601q14.77 0 30.08-5.35 15.3-5.34 30.15-14.27l24.23-22.53q59.46 43.92 93.5 108.42T773-399.83q0 121.91-85.24 207.37Q602.52-107 480-107t-207.76-85.24Q187-277.48 187-400q0-107.85 71.08-213.65Q329.15-719.46 453-789.46Z"],[1,"info__text"],["height","24px","viewBox","0 -960 960 960","width","24px",1,"available"],["d","m346.92-70.77-72.77-124.61-141.07-31.39 14.46-145.08L51.85-480l95.69-108.15-14.46-145.08 141.07-31.39 72.77-124.61L480-832.92l133.08-56.31 72.77 124.61 141.07 31.39-14.46 145.08L908.15-480l-95.69 108.15 14.46 145.08-141.07 31.39-72.77 124.61L480-127.08 346.92-70.77ZM376-156l104-44.46L586.46-156 644-254l112-26.46L746-394l74-86-74-86.46L756-682l-112-24-60-98-104 44.46L373.54-804 316-706l-112 24 10 115.54L140-480l74 86-10 116 112 24 60 98Zm104-324Zm-42 134.31L658.31-566 611-611.77l-173 173-87-88.54L303.69-480 438-345.69Z"],["height","24px","viewBox","0 -960 960 960","width","24px",1,"unavailable"],["d","m334-287.69 146-146 146 146L672.31-334l-146-146 146-146L626-672.31l-146 146-146-146L287.69-626l146 146-146 146L334-287.69ZM480.13-88q-81.31 0-152.89-30.86-71.57-30.86-124.52-83.76-52.95-52.9-83.83-124.42Q88-398.55 88-479.87q0-81.56 30.92-153.37 30.92-71.8 83.92-124.91 53-53.12 124.42-83.48Q398.67-872 479.87-872q81.55 0 153.35 30.34 71.79 30.34 124.92 83.42 53.13 53.08 83.49 124.84Q872-561.64 872-480.05q0 81.59-30.34 152.83-30.34 71.23-83.41 124.28-53.07 53.05-124.81 84Q561.7-88 480.13-88Zm-.13-66q136.51 0 231.26-94.74Q806-343.49 806-480t-94.74-231.26Q616.51-806 480-806t-231.26 94.74Q154-616.51 154-480t94.74 231.26Q343.49-154 480-154Zm0-326Z"],[1,"errors"]],template:function(i,o){i&1&&(c(0,"div",0)(1,"span",1),S("click",function(){return o.backNavigateBtn()}),m(),c(2,"span",2),g(3),m(),c(4,"div",3),k(),c(5,"svg",4),S("click",function(){return o.showMenu()}),w(6,"path",5),m(),M(7,wi,3,0,"div",6),m()(),se(),c(8,"div",7)(9,"ng-select",8),Xe("ngModelChange",function(l){return Ke(o.selectedGame,l)||(o.selectedGame=l),l}),S("change",function(){return o.handleSelectGame()}),m()(),c(10,"form",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"span"),g(15),m(),k(),c(16,"svg",13),w(17,"path",14),m()(),se(),c(18,"div",12)(19,"span"),g(20),m(),k(),c(21,"svg",13),w(22,"path",15),m()()(),se(),c(23,"div",16),w(24,"img",17),m(),c(25,"div",18)(26,"div",12),k(),c(27,"svg",13),w(28,"path",19),m(),se(),c(29,"span"),g(30),m()(),c(31,"div",12),M(32,Si,2,0,"svg",20)(33,Mi,2,0,"svg",21)(34,yi,2,2,"span",22),m()()(),c(35,"div",23)(36,"span"),g(37),m()(),c(38,"div",24)(39,"div",25)(40,"label",26),g(41,"Choose Date"),m(),w(42,"input",27),m(),c(43,"div",28)(44,"label",29),g(45,"Choose Time"),m(),w(46,"input",30),m()(),w(47,"br"),c(48,"div",24)(49,"div",25)(50,"label",31),g(51,"Name"),m(),w(52,"input",32),m(),c(53,"div",28)(54,"label",33),g(55,"Max people"),m(),w(56,"input",34),m()(),c(57,"div",35),M(58,Ii,2,1,"div",36),m(),c(59,"div",37)(60,"div",38),S("click",function(){return o.onSubmit()}),k(),c(61,"svg",39),w(62,"path",40),m(),se(),c(63,"span"),g(64),m(),k(),c(65,"svg",39),w(66,"path",40),m()()()()),i&2&&(d(3),z(o.editRoomId?"Update Game Camp":"Create Game Camp"),d(4),_("ngIf",o.isMenuVisible),d(2),_("items",o.gameList),Je("ngModel",o.selectedGame),d(),_("formGroup",o.form),d(5),Ye("",o.getGame("averagePlaytime")," ",o.game?"m":""," "),d(5),qt("",o.getGame("minPlayers")," ",o.game?"-":""," ",o.getGame("maxPlayers"),""),d(4),_("ngClass",o.imagePreview?"green":"red")("src",o.imagePreview||"/shared/assets/images/default-no-image.jpg",Me),d(6),Ye("",o.getGame("minAge")," ",o.game?"+":""," "),d(2),_("ngIf",!o.gameInventory||o.gameInventory.availableCopies>0),d(),_("ngIf",o.gameInventory&&o.gameInventory.availableCopies===0),d(),_("ngIf",o.gameInventory),d(3),z(o.game==null?null:o.game.name),d(21),_("ngIf",o.getFirstErrorMessage()),d(3),_("ngClass",o.form.valid?"red-flames":"gray-flames"),d(3),V(" ",o.editRoomId?"Update the Camp":"Fire the Camp"," "),d(),_("ngClass",o.form.valid?"red-flames":"gray-flames"))},dependencies:[Wt,Z,zt,et,Zt,tt,Qt,Yt,Jt,nt,ln],styles:[`.select-container{display:flex;justify-content:center;margin-top:1rem}.wrapper_icons{display:flex;justify-content:space-between;padding:1rem 1rem 0;align-items:center}.wrapper_icons .header_name{font-size:1.5rem;padding-top:1rem;padding-bottom:.5rem;word-wrap:break-word;width:70%;text-align:center}.wrapper_icons .arrow{width:3rem;height:3rem;display:inline-block;position:relative;border:.1rem solid #98989d;border-radius:2.5rem}.wrapper_icons .arrow:before{content:"";display:block;width:.75rem;height:.75rem;top:65%;left:63%;border-style:solid;border-color:#98989d;border-width:.2rem .2rem 0 0;position:absolute;transform-origin:50% 50%}.wrapper_icons .arrow.left:before{transform:rotate(-135deg);margin:-.9rem 0 0 -.6rem}.info-container{position:relative}.info-container .info{width:3rem;height:3rem;fill:#75a0ff}.info-container .info__text{position:absolute;right:.5rem;top:2.25rem;background-color:#2b2e35;padding:.5rem;z-index:1000;width:10rem;text-align:center}.info-container .info__text span{width:9rem;text-align:center;line-height:2rem;font-size:1.2rem}.container-errors{display:flex;justify-content:center;align-items:center;margin-top:2rem}.wrapper_stats{display:flex;position:relative}.wrapper_stats .wrapper_image{position:absolute;top:55%;left:50%;transform:translate(-50%,-50%)}.wrapper_stats .wrapper_image img{width:8rem;height:8rem;object-fit:cover;border-radius:5rem}.wrapper_stats .wrapper_image .red{border:solid #bf3c65 1px}.wrapper_stats .wrapper_image .green{border:solid #46945b 1px}.wrapper_stats__chips-left{margin-top:2rem}.wrapper_stats__chips-left .chip{width:30vw;margin:1.5rem 0;background-color:#31313b;padding:.5rem 1rem;display:flex;justify-content:space-between;border-top-right-radius:2rem;border-bottom-right-radius:2rem;align-items:center}.wrapper_stats__chips-right{position:absolute;right:0;margin-top:2rem}.wrapper_stats__chips-right .chip{width:30vw;margin:1.5rem 0;background-color:#31313b;padding:.5rem 1rem;display:flex;justify-content:space-between;border-top-left-radius:2rem;border-bottom-left-radius:2rem;align-items:center}.wrapper_stats__chips-right .chip .available{fill:#46945b}.wrapper_stats__chips-right .chip .unavailable{fill:#bf3c65}.wrapper_title{margin:1rem;word-break:break-word;text-align:center;font-size:1.4rem}.wrapper_inputs{display:flex;justify-content:space-between}.wrapper_inputs .ng-touched.ng-invalid{border:.1rem solid #bf3c65}.wrapper_inputs__input{width:50%}.wrapper_inputs__input input{width:70%;border:none;min-width:80%;border-radius:5px;background-color:#31313b;padding:.4rem .8rem;color:#9b9b9b;border-top-right-radius:2rem;border-bottom-right-radius:2rem}.wrapper_inputs__time{text-align:end;width:50%}.wrapper_inputs__time input{width:70%;border:none;min-width:80%;border-radius:5px;background-color:#31313b;padding:.3rem .6rem;color:#9b9b9b;border-top-left-radius:2rem;border-bottom-left-radius:2rem}.wrapper_inputs label{font-size:1.1rem;color:#9b9b9b;margin:0 1.5rem;display:flex;justify-content:center}.wrapper_inputs input:focus{outline-style:solid;outline-color:#98989d;outline-width:.05rem}.btn-container{display:flex;justify-content:center}.btn-container .wrapper_btn{border-radius:2rem;width:70%;font-size:1.4rem;display:flex;justify-content:center;align-items:center;margin-top:2rem;margin-bottom:10rem;background-color:#31313b;padding:1rem}.btn-container .wrapper_btn svg{width:2rem;height:2rem}.btn-container .wrapper_btn .gray-flames{fill:#9b9b9b}@keyframes realisticFlames{0%{transform:scale(1) rotate(0) translateY(0);opacity:1}10%{transform:scale(1.1) rotate(1deg) translateY(-2px);opacity:.95}20%{transform:scale(1.15) rotate(-2deg) translateY(-4px);opacity:.9}30%{transform:scale(1.1) rotate(1deg) translateY(-3px);opacity:.93}40%{transform:scale(1.2) rotate(-1deg) translateY(-5px);opacity:.88}50%{transform:scale(1.1) rotate(0) translateY(-2px);opacity:.92}60%{transform:scale(1.15) rotate(-2deg) translateY(-6px);opacity:.85}70%{transform:scale(1.2) rotate(1deg) translateY(-4px);opacity:.9}80%{transform:scale(1.1) rotate(-1deg) translateY(-3px);opacity:.95}90%{transform:scale(1.15) rotate(2deg) translateY(-5px);opacity:.9}to{transform:scale(1) rotate(0) translateY(0);opacity:1}}.btn-container .wrapper_btn .red-flames{fill:#bf3c65;animation:realisticFlames 3s infinite}
`],encapsulation:2});let r=e;return r})();var Pi=[{path:"find",component:gn},{path:":id/details",component:vn},{path:"create",component:$t},{path:":id/update",component:$t},{path:":id/chat",component:Mn},{path:":id/chat/members",component:In}],Pn=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Ze({type:e}),e.\u0275inj=ze({imports:[kt.forChild(Pi),kt]});let r=e;return r})();var oa=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Ze({type:e}),e.\u0275inj=ze({imports:[rn,cn,Pn,pn,Xt,mn,sn]});let r=e;return r})();export{oa as FindMeepleManagementModule};
