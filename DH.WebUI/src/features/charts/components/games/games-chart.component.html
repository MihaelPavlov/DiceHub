<div class="wrapper_icons">
  <span (click)="backNavigateBtn()" class="arrow left"></span>
  <span class="header_name">Games Chart</span>
  <div class="info-container">
    <svg class="info" (click)="controls.toggleMenu()" viewBox="0 -960 960 960">
      <path
        d="M448-284h66v-236h-66v236Zm31.82-308.92q14.64 0 24.72-9.9 10.08-9.91 10.08-24.54 0-14.64-9.91-24.72-9.9-10.07-24.53-10.07-14.64 0-24.72 9.9-10.08 9.9-10.08 24.54 0 14.63 9.91 24.71 9.9 10.08 24.53 10.08ZM480.13-88q-81.31 0-152.89-30.86-71.57-30.86-124.52-83.76-52.95-52.9-83.83-124.42Q88-398.55 88-479.87q0-81.56 30.92-153.37 30.92-71.8 83.92-124.91 53-53.12 124.42-83.48Q398.67-872 479.87-872q81.55 0 153.35 30.34 71.79 30.34 124.92 83.42 53.13 53.08 83.49 124.84Q872-561.64 872-480.05q0 81.59-30.34 152.83-30.34 71.23-83.41 124.28-53.07 53.05-124.81 84Q561.7-88 480.13-88Z"
      />
    </svg>
  </div>
</div>
<div class="wrapper outer-container">
  <div class="input-field">
    <label for="type">Chart Type</label>

    <ng-select
      [items]="chartType"
      id="type"
      bindValue="id"
      bindLabel="name"
      class="app-select-long"
      [formControl]="gamesChartType"
    >
    </ng-select>
  </div>

  <div
    class="date_stepper"
    *ngIf="this.gamesChartType.value !== GamesActivityType.AllTime"
  >
    <svg
      class="arrow left"
      (click)="updateDateRange('backward')"
      viewBox="0 -960 960 960"
    >
      <path
        d="M332-234.31v-491.38L720.15-480 332-234.31ZM398-480Zm0 124 197.54-124L398-604v248Z"
      />
    </svg>

    <span class="date blue">{{
      this.gamesChartType.value !== null
        ? getFormattedRange()
        : "Select Chart Type"
    }}</span>

    <svg
      class="arrow"
      (click)="updateDateRange('forward')"
      viewBox="0 -960 960 960"
    >
      <path
        d="M332-234.31v-491.38L720.15-480 332-234.31ZM398-480Zm0 124 197.54-124L398-604v248Z"
      />
    </svg>
  </div>
  <ng-container
    *ngIf="gamesActivityDataSubject.asObservable()| async as games"
  >
    <div
      *ngIf="this.gamesChartType.value !== null && games.length === 0"
      class="no-games-message"
    >
      <p>No games were played during this period.</p>
      <p>
        Try selecting a different date range or chart type to view activity.
      </p>
    </div>

    <div
      *ngFor="let game of games; let i = index"
      class="wrapper_data"
      (click)="onClickGame(game.gameId)"
    >
      <div class="wrapper_users__item">
        <span class="number" [randomColor]="i">{{ i + 1 }}</span>
        <div class="wrapper_image">
          <img
            [src]="
              ImageEntityType.Games | entityImage : game.gameImageId | async
            "
            alt="Game Image"
          />
        </div>
        <div class="wrapper_users__item__info">
          <span class="name">{{ game.gameName }}</span>
          <span class="value">{{ game.timesPlayed }}</span>
        </div>
      </div>
      <ng-container
        *ngIf="
          selectedGameId === game.gameId &&
          (selectedGameUsers.asObservable() | async) as users
        "
      >
        <div class="user-cards" @slideToggle>
          <div *ngFor="let user of users; let idx = index" class="user-card">
            <div class="user-card__header">
              <span class="user-index">#{{ idx + 1 }}</span>
              <span
                class="user-name"
                [title]="user.userDisplayName || 'Anonymous'"
              >
                {{ user.userDisplayName || "Anonymous" }}
              </span>
            </div>
            <div class="user-card__details">
              <span class="label">Last Played At:</span>
              <span class="value">{{
                user.lastPlayedAt | date : DATE_TIME_FORMAT
              }}</span>
            </div>
            <div class="user-card__details">
              <span class="label">Times Played:</span>
              <span class="value">{{ user.timesPlayedFromUser }}</span>
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </ng-container>
</div>

<app-controls-menu
  #controls
  [isInfo]="true"
  infoDescription="This chart shows how frequently each game was played within the selected time range. 
You can explore weekly, monthly, or yearly trends by adjusting the chart type. 
Only games with recorded activity will appear.

Tap on a game to see which users played it during the selected period."
></app-controls-menu>
